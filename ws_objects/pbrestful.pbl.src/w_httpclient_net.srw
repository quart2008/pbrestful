$PBExportHeader$w_httpclient_net.srw
forward
global type w_httpclient_net from window
end type
type cb_13 from commandbutton within w_httpclient_net
end type
type st_27 from statictext within w_httpclient_net
end type
type st_text from statictext within w_httpclient_net
end type
type st_code from statictext within w_httpclient_net
end type
type cb_18 from commandbutton within w_httpclient_net
end type
type cb_17 from commandbutton within w_httpclient_net
end type
type cb_7 from commandbutton within w_httpclient_net
end type
type cb_2 from commandbutton within w_httpclient_net
end type
type cb_5 from commandbutton within w_httpclient_net
end type
type cb_4 from commandbutton within w_httpclient_net
end type
type cb_3 from commandbutton within w_httpclient_net
end type
type sle_1 from singlelineedit within w_httpclient_net
end type
type tab_1 from tab within w_httpclient_net
end type
type tabpage_1 from userobject within tab_1
end type
type st_28 from statictext within tabpage_1
end type
type ddlb_1 from dropdownlistbox within tabpage_1
end type
type rb_2 from radiobutton within tabpage_1
end type
type rb_1 from radiobutton within tabpage_1
end type
type cb_1 from commandbutton within tabpage_1
end type
type sle_staffid1 from singlelineedit within tabpage_1
end type
type st_4 from statictext within tabpage_1
end type
type sle_method1 from singlelineedit within tabpage_1
end type
type st_3 from statictext within tabpage_1
end type
type sle_url1 from singlelineedit within tabpage_1
end type
type st_2 from statictext within tabpage_1
end type
type mle_1 from multilineedit within tabpage_1
end type
type tabpage_1 from userobject within tab_1
st_28 st_28
ddlb_1 ddlb_1
rb_2 rb_2
rb_1 rb_1
cb_1 cb_1
sle_staffid1 sle_staffid1
st_4 st_4
sle_method1 sle_method1
st_3 st_3
sle_url1 sle_url1
st_2 st_2
mle_1 mle_1
end type
type tabpage_2 from userobject within tab_1
end type
type st_29 from statictext within tabpage_2
end type
type ddlb_2 from dropdownlistbox within tabpage_2
end type
type rb_4 from radiobutton within tabpage_2
end type
type rb_3 from radiobutton within tabpage_2
end type
type st_34 from statictext within tabpage_2
end type
type mle_2 from multilineedit within tabpage_2
end type
type cb_6 from commandbutton within tabpage_2
end type
type sle_staffid2 from singlelineedit within tabpage_2
end type
type st_6 from statictext within tabpage_2
end type
type sle_method2 from singlelineedit within tabpage_2
end type
type st_5 from statictext within tabpage_2
end type
type sle_url2 from singlelineedit within tabpage_2
end type
type st_1 from statictext within tabpage_2
end type
type tabpage_2 from userobject within tab_1
st_29 st_29
ddlb_2 ddlb_2
rb_4 rb_4
rb_3 rb_3
st_34 st_34
mle_2 mle_2
cb_6 cb_6
sle_staffid2 sle_staffid2
st_6 st_6
sle_method2 sle_method2
st_5 st_5
sle_url2 sle_url2
st_1 st_1
end type
type tabpage_3 from userobject within tab_1
end type
type st_35 from statictext within tabpage_3
end type
type ddlb_3 from dropdownlistbox within tabpage_3
end type
type rb_6 from radiobutton within tabpage_3
end type
type rb_5 from radiobutton within tabpage_3
end type
type st_10 from statictext within tabpage_3
end type
type sle_product3 from singlelineedit within tabpage_3
end type
type st_9 from statictext within tabpage_3
end type
type st_8 from statictext within tabpage_3
end type
type st_7 from statictext within tabpage_3
end type
type sle_url3 from singlelineedit within tabpage_3
end type
type sle_method3 from singlelineedit within tabpage_3
end type
type sle_staffid3 from singlelineedit within tabpage_3
end type
type mle_3 from multilineedit within tabpage_3
end type
type cb_8 from commandbutton within tabpage_3
end type
type tabpage_3 from userobject within tab_1
st_35 st_35
ddlb_3 ddlb_3
rb_6 rb_6
rb_5 rb_5
st_10 st_10
sle_product3 sle_product3
st_9 st_9
st_8 st_8
st_7 st_7
sle_url3 sle_url3
sle_method3 sle_method3
sle_staffid3 sle_staffid3
mle_3 mle_3
cb_8 cb_8
end type
type tabpage_4 from userobject within tab_1
end type
type st_36 from statictext within tabpage_4
end type
type ddlb_4 from dropdownlistbox within tabpage_4
end type
type rb_8 from radiobutton within tabpage_4
end type
type rb_7 from radiobutton within tabpage_4
end type
type mle_4 from multilineedit within tabpage_4
end type
type cb_9 from commandbutton within tabpage_4
end type
type sle_product4 from singlelineedit within tabpage_4
end type
type st_14 from statictext within tabpage_4
end type
type sle_staffid4 from singlelineedit within tabpage_4
end type
type st_13 from statictext within tabpage_4
end type
type sle_method4 from singlelineedit within tabpage_4
end type
type st_12 from statictext within tabpage_4
end type
type st_11 from statictext within tabpage_4
end type
type sle_url4 from singlelineedit within tabpage_4
end type
type tabpage_4 from userobject within tab_1
st_36 st_36
ddlb_4 ddlb_4
rb_8 rb_8
rb_7 rb_7
mle_4 mle_4
cb_9 cb_9
sle_product4 sle_product4
st_14 st_14
sle_staffid4 sle_staffid4
st_13 st_13
sle_method4 sle_method4
st_12 st_12
st_11 st_11
sle_url4 sle_url4
end type
type tabpage_5 from userobject within tab_1
end type
type st_37 from statictext within tabpage_5
end type
type ddlb_5 from dropdownlistbox within tabpage_5
end type
type rb_10 from radiobutton within tabpage_5
end type
type rb_9 from radiobutton within tabpage_5
end type
type mle_5 from multilineedit within tabpage_5
end type
type cb_10 from commandbutton within tabpage_5
end type
type sle_product5 from singlelineedit within tabpage_5
end type
type st_18 from statictext within tabpage_5
end type
type sle_staffid5 from singlelineedit within tabpage_5
end type
type st_17 from statictext within tabpage_5
end type
type sle_method5 from singlelineedit within tabpage_5
end type
type st_16 from statictext within tabpage_5
end type
type st_15 from statictext within tabpage_5
end type
type sle_url5 from singlelineedit within tabpage_5
end type
type tabpage_5 from userobject within tab_1
st_37 st_37
ddlb_5 ddlb_5
rb_10 rb_10
rb_9 rb_9
mle_5 mle_5
cb_10 cb_10
sle_product5 sle_product5
st_18 st_18
sle_staffid5 sle_staffid5
st_17 st_17
sle_method5 sle_method5
st_16 st_16
st_15 st_15
sle_url5 sle_url5
end type
type tabpage_6 from userobject within tab_1
end type
type st_38 from statictext within tabpage_6
end type
type ddlb_6 from dropdownlistbox within tabpage_6
end type
type rb_12 from radiobutton within tabpage_6
end type
type rb_11 from radiobutton within tabpage_6
end type
type sle_file from singlelineedit within tabpage_6
end type
type cb_14 from commandbutton within tabpage_6
end type
type st_30 from statictext within tabpage_6
end type
type sle_filepath from singlelineedit within tabpage_6
end type
type mle_6 from multilineedit within tabpage_6
end type
type cb_11 from commandbutton within tabpage_6
end type
type sle_fileid6 from singlelineedit within tabpage_6
end type
type st_22 from statictext within tabpage_6
end type
type sle_staffid6 from singlelineedit within tabpage_6
end type
type st_21 from statictext within tabpage_6
end type
type sle_method6 from singlelineedit within tabpage_6
end type
type st_20 from statictext within tabpage_6
end type
type st_19 from statictext within tabpage_6
end type
type sle_url6 from singlelineedit within tabpage_6
end type
type tabpage_6 from userobject within tab_1
st_38 st_38
ddlb_6 ddlb_6
rb_12 rb_12
rb_11 rb_11
sle_file sle_file
cb_14 cb_14
st_30 st_30
sle_filepath sle_filepath
mle_6 mle_6
cb_11 cb_11
sle_fileid6 sle_fileid6
st_22 st_22
sle_staffid6 sle_staffid6
st_21 st_21
sle_method6 sle_method6
st_20 st_20
st_19 st_19
sle_url6 sle_url6
end type
type tabpage_7 from userobject within tab_1
end type
type st_39 from statictext within tabpage_7
end type
type ddlb_7 from dropdownlistbox within tabpage_7
end type
type rb_14 from radiobutton within tabpage_7
end type
type rb_13 from radiobutton within tabpage_7
end type
type mle_7 from multilineedit within tabpage_7
end type
type cb_12 from commandbutton within tabpage_7
end type
type sle_filename from singlelineedit within tabpage_7
end type
type st_26 from statictext within tabpage_7
end type
type sle_staffid7 from singlelineedit within tabpage_7
end type
type st_25 from statictext within tabpage_7
end type
type sle_method7 from singlelineedit within tabpage_7
end type
type st_24 from statictext within tabpage_7
end type
type st_23 from statictext within tabpage_7
end type
type sle_url7 from singlelineedit within tabpage_7
end type
type tabpage_7 from userobject within tab_1
st_39 st_39
ddlb_7 ddlb_7
rb_14 rb_14
rb_13 rb_13
mle_7 mle_7
cb_12 cb_12
sle_filename sle_filename
st_26 st_26
sle_staffid7 sle_staffid7
st_25 st_25
sle_method7 sle_method7
st_24 st_24
st_23 st_23
sle_url7 sle_url7
end type
type tabpage_9 from userobject within tab_1
end type
type st_40 from statictext within tabpage_9
end type
type ddlb_8 from dropdownlistbox within tabpage_9
end type
type rb_16 from radiobutton within tabpage_9
end type
type rb_15 from radiobutton within tabpage_9
end type
type mle_9 from multilineedit within tabpage_9
end type
type cb_16 from commandbutton within tabpage_9
end type
type sle_staffid9 from singlelineedit within tabpage_9
end type
type st_33 from statictext within tabpage_9
end type
type sle_method9 from singlelineedit within tabpage_9
end type
type st_32 from statictext within tabpage_9
end type
type sle_url9 from singlelineedit within tabpage_9
end type
type st_31 from statictext within tabpage_9
end type
type tabpage_9 from userobject within tab_1
st_40 st_40
ddlb_8 ddlb_8
rb_16 rb_16
rb_15 rb_15
mle_9 mle_9
cb_16 cb_16
sle_staffid9 sle_staffid9
st_33 st_33
sle_method9 sle_method9
st_32 st_32
sle_url9 sle_url9
st_31 st_31
end type
type tab_1 from tab within w_httpclient_net
tabpage_1 tabpage_1
tabpage_2 tabpage_2
tabpage_3 tabpage_3
tabpage_4 tabpage_4
tabpage_5 tabpage_5
tabpage_6 tabpage_6
tabpage_7 tabpage_7
tabpage_9 tabpage_9
end type
end forward

global type w_httpclient_net from window
integer width = 3584
integer height = 1852
boolean titlebar = true
string title = "HttpClient RestFul (for .Net)"
boolean controlmenu = true
boolean minbox = true
boolean maxbox = true
boolean resizable = true
long backcolor = 67108864
string icon = "AppIcon!"
boolean center = true
cb_13 cb_13
st_27 st_27
st_text st_text
st_code st_code
cb_18 cb_18
cb_17 cb_17
cb_7 cb_7
cb_2 cb_2
cb_5 cb_5
cb_4 cb_4
cb_3 cb_3
sle_1 sle_1
tab_1 tab_1
end type
global w_httpclient_net w_httpclient_net

type prototypes

end prototypes

type variables
String 	is_sign, is_value, is_ip, is_ip_https
eon_appeon_resize  ieon_resize
end variables

forward prototypes
public function string wf_gettimestamp ()
public function string wf_getrandom ()
public function string wf_getmd5 (string as_str)
public function string wf_getsignature (string as_timestamp, string as_nonces, string as_staffid, string as_data)
public subroutine of_parsejson (jsonparser anv_jsonparser, long alp_handle, string as_key)
public subroutine wf_selectsort (ref character ai_input[])
public subroutine wf_sort (ref character ac_input[])
end prototypes

public function string wf_gettimestamp ();Long 		ll_days, ll_Seconds, ll_microsecond
Double 	ll_Stamp
Date 		ld_Today
Time 		lt_Now

ld_Today = Today()
ll_days = DaysAfter ( Date(1970,1,1), ld_Today )

lt_Now = Now()
ll_Seconds = SecondsAfter ( Time ( 8,0,0 ), lt_Now )

ll_Stamp = ll_days * 24 * 60 * 60 + ll_Seconds


Return String ( ll_Stamp ) + Left ( String ( lt_now, "ffffff" ), 3 )
end function

public function string wf_getrandom ();Long 		ll_Random

ll_Random = Rand(32767)

Return  Right ( "1142338327"  + String (ll_Random), 10 )
end function

public function string wf_getmd5 (string as_str);//调用样例:
u_derek_md5 lu_md5
lu_md5=create u_derek_md5
string ls_text = "", ls_char
string ls_result,ls_ret, ls_new_text

ls_text=as_str
char lc_char[]

Long 	ll_I, ll_Row, ll_Count

lc_char =ls_text

ll_Count = UpperBound ( lc_char )
wf_sort(lc_char)
//wf_selectsort(lc_char)
////

ll_Count = UpperBound ( lc_char )
For ll_I = 1 To ll_Count
	ls_new_text = ls_new_text +  lc_char[ll_I]
Next


////gf_quicksort(lc_char,upperbound(lc_char),1)
//
//
////MessageBox ( "tip", ls_new_text  )
//
////排序处理
//DataStore 	lds_data
//lds_data = Create DataStore
//lds_data.DataObject = "d_md5"
//
//For ll_I = 1 To ll_Count
//	//ls_char = Mid ( ls_text, ll_I, 1 )
//	ll_Row = lds_Data.InsertRow ( 0 )
//	lds_Data.SetItem( ll_Row, "char1", lc_char[ll_I])
//	lds_Data.SetItem( ll_Row, "long2", asc(lc_char[ll_I]))
//Next
//
//lds_Data.SetSort ( "long2" )
//lds_Data.Sort ()
////获取排序后的字符串
//For ll_I = 1 To lds_Data.RowCount ()
//	ls_new_text += lds_Data.GetItemString ( ll_I, 'char1' )
//Next

//Messagebox ( "",ls_new_text )
//对字符串进行md5
lu_md5.uf_md5string(ls_new_text,ref ls_result)

destroy lu_md5

Return ls_result

end function

public function string wf_getsignature (string as_timestamp, string as_nonces, string as_staffid, string as_data);Long 	ll_rtn
String ls_Respose, ls_Body, ls_Error, ls_txt, ls_Return
HttpClient 	lhc_Client
lhc_Client = Create HttpClient
lhc_Client.SetRequestHeader ( "staffid", as_staffid )
lhc_Client.SetRequestHeader ( "timestamp", as_timestamp )
lhc_Client.SetRequestHeader ( "nonces", as_nonces )
lhc_Client.SetRequestHeader ( "Content-Type", "application/json" )
lhc_Client.SetRequestHeader ( "Pragma", "no-cache" )
ll_rtn = lhc_Client.sendrequest( "GET", "http://192.0.3.200:9000/api/Token/GetToken?staffId=" + as_staffid )


ls_Respose = lhc_Client.Getresponseheaders( )
ll_rtn = lhc_Client.GetResponsebody( ls_Body)
If Len ( ls_body ) > 0 Then		
	//json to string
	JsonParser lnv_JsonParser
	LongPtr ll_RootHandle, llp_Child, llp_Child2
	JsonItemType lji_1, lji_2, lji_3
	
	lnv_JsonParser = Create JsonParser
			
	ls_Error = lnv_JsonParser.loadstring(ls_Body)
	if Len(ls_Error) > 0 then
		MessageBox("Error", ls_Error)
		Return ls_Return
	end if
	
	//{"Code":200,"Message":"","Data":{"StaffId":10000,"SignToken":"bb5eeee1-2959-4e80-9d7b-ec5bfd8eb4ad","ExpireTime":"2017-10-19T14:26:01.2486647+08:00"}}
	ll_RootHandle = lnv_JsonParser.GetRootItem ( ) 
	lji_1 = lnv_JsonParser.GetItemType ( ll_RootHandle )
	if lji_1 = JsonObjectItem! Then
		llp_Child = lnv_JsonParser.GetChildItem ( ll_RootHandle, 3 )
		llp_Child2 = lnv_JsonParser.GetChildItem ( llp_Child, 2 )
		is_sign = lnv_JsonParser.GetItemString ( llp_Child2 )
		//timeStamp + nonces + staffId + token.SignToken.ToString() + data
		ls_Return = wf_GetMd5 ( as_timeStamp + as_nonces + as_staffId + is_sign + as_data )
	End If
	
	DesTroy ( lnv_JsonParser )

End If
	

Return ls_Return
end function

public subroutine of_parsejson (jsonparser anv_jsonparser, long alp_handle, string as_key);//of_ParseJson(JsonParser anv_JsonParser, longptr alp_Handle)

Long 	ll_ChildCount, ll_index, llp_child, llp_root
String ls_null
JsonItemType ljit_JsonItemType

ljit_JsonItemType = anv_JsonParser.GetItemType(alp_Handle)

// 根据结点类型递归或取结点的值
if ljit_JsonItemType = JsonObjectItem! or ljit_JsonItemType = JsonArrayItem! then
	// 递归结点
	ll_ChildCount = anv_JsonParser.GetChildCount(alp_Handle)
	for ll_Index = 1 to ll_ChildCount
		llp_Child = anv_JsonParser.GetChildItem(alp_Handle, ll_Index)
		string ls_key
		ls_key = anv_JsonParser.GetChildKey(alp_Handle, ll_Index)
//		If IsNull ( ls_key ) Or Trim ( ls_key ) = "" Then
//			ls_key = "none"
//		End If		
		of_ParseJson(anv_JsonParser, llp_Child,ls_key)
	next
else // 取结点的值
	choose case ljit_JsonItemType
		case JsonStringItem!
			String ls_value 
			ls_value = anv_JsonParser.GetItemString(alp_Handle)				
			is_value = is_value + as_key + ": " + ls_value + "~r~n"
		case JsonNumberItem!
			Double ldb_value
			ldb_value = anv_JsonParser.GetItemNumber(alp_Handle)
			is_value = is_value + as_key + ": " + string ( ldb_value) + "~r~n"
		case JsonBooleanItem!
			Boolean lb_value
			lb_value = anv_JsonParser.GetItemBoolean(alp_Handle)
			is_value = is_value +as_key+ ": " + string ( lb_value) + "~r~n"
		case JsonNullItem!
			//SetNull(ls_Null)			
			is_value = is_value + as_key + ": null " + "~r~n"
	end choose
end if

end subroutine

public subroutine wf_selectsort (ref character ai_input[]);int i,j,li_count,li_pos
char lc_temp

li_count = upperbound(ai_input)

for i = 1 to li_count - 1
	li_pos = i
	for j = i +1 to li_count
		if asc(ai_input[j]) <= asc(ai_input[li_pos]) then
			li_pos = j
		end if	
	next
	//if li_pos <> i then
	lc_temp = ai_input[i]
	ai_input[i] = ai_input[li_pos]
	ai_input[li_pos] = lc_temp
	//end if
next
end subroutine

public subroutine wf_sort (ref character ac_input[]);Long i,li_count
Long 	ll_count[95]
String 	ls_String
// !"#$%&~'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\]^_`abcdefghijklmnopqrstuvwxyz{|}~~
char lc_char[] = {' ','!','"','#','$','%','&','~'','(',')','*','+',',','-','.','/','0','1','2','3','4','5','6','7','8','9',':',';','<','=','>','?','@',&
						'A','B','C','D','E','F','G','H','I','J','K','L','M','N','O','P','Q','R','S','T','U','V','W','X','Y','Z','[','\',']','^','_','`',&
						'a','b','c','d','e','f','g','h','i','j','k','l','m','n','o','p','q','r','s','t','u','v','w','x','y','z','{','|','}','~~'}

//MessageBox( "", String (UpperBound ( lc_char )) )

li_count = upperbound(ac_input)

For i = 1 To li_count
	choose case ac_input[i]		
		case ' '
			ll_count[1]++
		case '!'
			ll_count[2]++
		case '"'
			ll_count[3]++
		case '#'
			ll_count[4]++
		case '$'
			ll_count[5]++
		case '%'
			ll_count[6]++
		case '&'
			ll_count[7]++
		case '~''
			ll_count[8]++
		case '('
			ll_count[9]++
		case ')'
			ll_count[10]++
		case '*'
			ll_count[11]++
		case '+'
			ll_count[12]++
		case ','
			ll_count[13]++
		case '-'
			ll_count[14]++
		case '.'
			ll_count[15]++
		case '/'
			ll_count[16]++
		case '0'
			ll_count[17]++
		case '1'
			ll_count[18]++
		case '2'
			ll_count[19]++
		case '3'
			ll_count[20]++
		case '4'
			ll_count[21]++
		case '5'
			ll_count[22]++
		case '6'
			ll_count[23]++
		case '7'
			ll_count[24]++
		case '8'
			ll_count[25]++
		case '9'
			ll_count[26]++
		case ':'
			ll_count[27]++
		case ';'
			ll_count[28]++
		case '<'
			ll_count[29]++
		case '='
			ll_count[30]++
		case '>'
			ll_count[31]++
		case '?'
			ll_count[32]++
		case '@'
			ll_count[33]++
		case 'A'
			ll_count[34]++
		case 'B'
			ll_count[35]++
		case 'C'
			ll_count[36]++
		case 'D'
			ll_count[37]++
		case 'E'
			ll_count[38]++
		case 'F'
			ll_count[39]++
		case 'G'
			ll_count[40]++
		case 'H'
			ll_count[41]++
		case 'I'
			ll_count[42]++
		case 'J'
			ll_count[43]++
		case 'K'
			ll_count[44]++
		case 'L'
			ll_count[45]++
		case 'M'
			ll_count[46]++
		case 'N'
			ll_count[47]++
		case 'O'
			ll_count[48]++
		case 'P'
			ll_count[49]++
		case 'Q'
			ll_count[50]++
		case 'R'
			ll_count[51]++
		case 'S'
			ll_count[52]++
		case 'T'
			ll_count[53]++
		case 'U'
			ll_count[54]++
		case 'V'
			ll_count[55]++
		case 'W'
			ll_count[56]++
		case 'X'
			ll_count[57]++
		case 'Y'
			ll_count[58]++
		case 'Z'
			ll_count[59]++
		case '['
			ll_count[60]++
		case '\'
			ll_count[61]++
		case ']'
			ll_count[62]++
		case '^'
			ll_count[63]++
		case '_'
			ll_count[64]++
		case '`'
			ll_count[65]++
		case 'a'
			ll_count[66]++
		case 'b'
			ll_count[67]++
		case 'c'
			ll_count[68]++
		case 'd'
			ll_count[69]++
		case 'e'
			ll_count[70]++
		case 'f'
			ll_count[71]++
		case 'g'
			ll_count[72]++
		case 'h'
			ll_count[73]++
		case 'i'
			ll_count[74]++
		case 'j'
			ll_count[75]++
		case 'k'
			ll_count[76]++
		case 'l'
			ll_count[77]++
		case 'm'
			ll_count[78]++
		case 'n'
			ll_count[79]++
		case 'o'
			ll_count[80]++
		case 'p'
			ll_count[81]++
		case 'q'
			ll_count[82]++
		case 'r'
			ll_count[83]++
		case 's'
			ll_count[84]++
		case 't'
			ll_count[85]++
		case 'u'
			ll_count[86]++
		case 'v'
			ll_count[87]++
		case 'w'
			ll_count[88]++
		case 'x'
			ll_count[89]++
		case 'y'
			ll_count[90]++
		case 'z'
			ll_count[91]++
		case '{'
			ll_count[92]++
		case '|'
			ll_count[93]++
		case '}'
			ll_count[94]++
		case '~~'
			ll_count[95]++
		case else
			MessageBox ( "Tip", string (ac_input[i]) )
	End choose
Next

For i = 1 To UpperBound(ll_count)
	ls_String = ls_String + Fill( lc_char[i], ll_count[i])
Next


ac_input = ls_String

end subroutine

on w_httpclient_net.create
this.cb_13=create cb_13
this.st_27=create st_27
this.st_text=create st_text
this.st_code=create st_code
this.cb_18=create cb_18
this.cb_17=create cb_17
this.cb_7=create cb_7
this.cb_2=create cb_2
this.cb_5=create cb_5
this.cb_4=create cb_4
this.cb_3=create cb_3
this.sle_1=create sle_1
this.tab_1=create tab_1
this.Control[]={this.cb_13,&
this.st_27,&
this.st_text,&
this.st_code,&
this.cb_18,&
this.cb_17,&
this.cb_7,&
this.cb_2,&
this.cb_5,&
this.cb_4,&
this.cb_3,&
this.sle_1,&
this.tab_1}
end on

on w_httpclient_net.destroy
destroy(this.cb_13)
destroy(this.st_27)
destroy(this.st_text)
destroy(this.st_code)
destroy(this.cb_18)
destroy(this.cb_17)
destroy(this.cb_7)
destroy(this.cb_2)
destroy(this.cb_5)
destroy(this.cb_4)
destroy(this.cb_3)
destroy(this.sle_1)
destroy(this.tab_1)
end on

event open;ieon_resize = create eon_appeon_resize

ieon_resize.of_init(this,true)

is_ip =  profilestring("config.ini","settings","Restful_http_DotNet","")
//设置url
tab_1.tabpage_1.sle_url1.Text = is_ip + "/api/Token/GetToken"
tab_1.tabpage_2.sle_url2.Text = is_ip + "/api/Product/GetProductList"
tab_1.tabpage_3.sle_url3.Text = is_ip + "/api/Product/GetProduct"
tab_1.tabpage_4.sle_url4.Text = is_ip + "/api/Product/EditProduct"
tab_1.tabpage_5.sle_url5.Text = is_ip + "/api/Product/DeleteProduct"
tab_1.tabpage_6.sle_url6.Text = is_ip + "/api/File/UploadFile"
tab_1.tabpage_7.sle_url7.Text = is_ip + "/api/File/DownloadFile"
tab_1.tabpage_9.sle_url9.Text = is_ip + "/api/Header/GetHeaderList"


//https
is_ip_https = profilestring("config.ini","settings","Restful_https_DotNet","")
end event

event resize;ieon_resize.of_resize(this,newwidth,newheight,true)
end event

type cb_13 from commandbutton within w_httpclient_net
integer x = 2656
integer y = 1572
integer width = 343
integer height = 100
integer taborder = 90
integer textsize = -9
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
string text = "wf_time13"
end type

event clicked;//对字符串进行md5

String ls_aa

ls_aa = wf_gettimestamp()
MessageBox ( "", ls_aa )
end event

type st_27 from statictext within w_httpclient_net
integer x = 1042
integer y = 1308
integer width = 1961
integer height = 56
integer textsize = -9
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 128
long backcolor = 67108864
string text = "如果遇到407返回值,请查看本地时间是否是北京时间(Net服务器是北京时间)"
boolean focusrectangle = false
end type

type st_text from statictext within w_httpclient_net
integer x = 398
integer y = 1308
integer width = 521
integer height = 56
integer textsize = -9
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 128
long backcolor = 67108864
string text = "text"
boolean focusrectangle = false
end type

type st_code from statictext within w_httpclient_net
integer x = 37
integer y = 1308
integer width = 343
integer height = 56
integer textsize = -9
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 128
long backcolor = 67108864
string text = "code"
boolean focusrectangle = false
end type

type cb_18 from commandbutton within w_httpclient_net
integer x = 1344
integer y = 1580
integer width = 343
integer height = 100
integer taborder = 80
integer textsize = -9
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
string text = "GetBase64"
end type

event clicked;string ls_return
Blob  lb_return, lb_data
nvo_base64 luo_base64
String 	ls_user, ls_pass
ls_user = "Af-Bf-ZPrD0j1aXrGRsnAgx2-rcuE-ZTQOr9mEvqsiOzOaaA6ZcoUjjgz-0b3a10106tnaz4wbmF-rg3"
ls_pass = "EH2OWHgxMgyKc-tN_EGZAh0Kg4i2f7HHR5TFBY1eX06ZuOuVpHzPwdV3kV9XVS8AQiru5GSEh126vEJh"
lb_data = Blob(ls_user + ":" + ls_pass,EncodingUTF8!)
//lb_data = Blob( "bXl1c2VyOm15cGFzcw==", EncodingUtf8!)
ls_return = luo_base64.base64encode(lb_data)
MessageBox ( "auth", string ( ls_return) )

//lb_return = luo_base64.base64decode("bXl1c2VyOm15cGFzcw==")
//MessageBox ( ls_return, string ( lb_return,EncodingUTF8!) )
end event

type cb_17 from commandbutton within w_httpclient_net
boolean visible = false
integer x = 2574
integer y = 1576
integer width = 343
integer height = 100
integer taborder = 90
integer textsize = -9
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
boolean enabled = false
string text = "none"
end type

event clicked;//char lc_char[] 
//String 	ls_str, ls_temp
//Long 		ll_i
/////////////// !"#$%&()*+,-./0123456789:<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\]^_abcdefghijklmnopqrstuvwxyz{|}~~
/////////////// !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_`abcdefghijklmnopqrstuvwxyz{|}~;
//ls_temp = ' !"#$%&~'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\]^_`abcdefghijklmnopqrstuvwxyz{|}~~'
//lc_char = ls_temp
//For ll_I = 1 To Upperbound ( lc_char )
//	ls_str = ls_str + "case #" + lc_char[ll_I] + "#" + "~n~t" + "ll_count[" + String ( ll_I ) + "]++~n"
//Next
//
//Messagebox ( String (Upperbound ( lc_char )),ls_str )



end event

type cb_7 from commandbutton within w_httpclient_net
integer x = 2167
integer y = 1580
integer width = 343
integer height = 100
integer taborder = 80
integer textsize = -9
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
string text = "wf_GetMd5"
end type

event clicked;//对字符串进行md5

String ls_aa
//ls_aa = wf_Getmd5 ( ' !"#$%&~'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\]^_`abcdefghijklmnopqrstuvwxyz{|}~~')
//"\"\"\"\"\"\"\"\"\"\",,,.01188::::CEINPPaccdddeeiimnoorrtttuu{}
ls_aa = wf_Getmd5 ( '1510794363220423383274210000b8d681cb-5d96-40f3-a2a2-d1437439ea15id1')
MessageBox ( "", ls_aa )
end event

type cb_2 from commandbutton within w_httpclient_net
integer x = 1755
integer y = 1580
integer width = 343
integer height = 100
integer taborder = 80
integer textsize = -9
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
string text = "GetMd5"
end type

event clicked;//对字符串进行md5
String 	ls_new_text, ls_result

u_derek_md5 lu_md5
lu_md5=create u_derek_md5
ls_new_text = "----0000000011111112222233333334555566666778888999999aabbccdeeeeffi"
lu_md5.uf_md5string(ls_new_text,ref ls_result)

destroy lu_md5

MessageBox ( "", ls_result )
end event

type cb_5 from commandbutton within w_httpclient_net
boolean visible = false
integer x = 2167
integer y = 1452
integer width = 343
integer height = 100
integer taborder = 70
integer textsize = -9
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
string text = "POST test"
end type

event clicked;HttpClient 	lhc_Client
String 		ls_Url, ls_id, ls_Method, ls_Body, ls_Respose, ls_txt, ls_Post, ls_Request, ls_Cookie
Long 			ll_rtn, ll_Code

lhc_Client = Create HttpClient

//ls_id = Trim ( sle_Staffid1.Text )
ls_Url = Trim ( sle_1.Text ) 
//ls_Method = Trim ( sle_Method1.Text )
//
//lhc_Client.SetRequestHeader ( "staffid", ls_id )
//lhc_Client.SetRequestHeader ( "timestamp", wf_getTimeStamp() )
//lhc_Client.SetRequestHeader ( "nonces", "1862893498" /* + wf_getRandom() */)
//If Len ( is_sign ) > 0 Then
//	lhc_Client.SetRequestHeader ( "signature", is_sign )
//End If
//ll_rtn = lhc_Client.sendrequest( "GET","https://www.appeon.com/user/login?destination=node/252")

lhc_Client.SetRequestHeader ( "Content-Type", "application/x-www-form-urlencoded;" )
lhc_Client.SetRequestHeader ( "Pragma", "no-cache" )
lhc_Client.SetRequestHeader ( "User-Agent", "Mozilla/5.0 (Windows NT 6.1; Trident/7.0; rv:11.0) like Gecko" )

lhc_Client.AutoReadData = False
//lhc_Client.SecureProtocol = 3
//lhc_Client.Timeout = 20
ls_Post = "name=pangchuguan%40appeon.com&pass=appeon&remember_me=1&form_build_id=form-Lkm6IpfPM-l5m_9aKZGkPfh2coXR9JeKdO1SxkeF35s&form_id=user_login&op=Log+In"
ll_rtn = lhc_Client.sendrequest( "POST", "https://www.appeon.com/user/login?destination=node/252", ls_Post)
If ll_rtn = 1 Then
	ll_Code =  lhc_Client.GetResponseStatusCode()
	ls_txt = lhc_Client.GetResponseStatusText()
	ls_Request = lhc_Client.GetRequestHeaders()
	ls_Respose = lhc_Client.Getresponseheaders( )
	ll_rtn = lhc_Client.GetResponsebody( ls_Body)
	If Len ( ls_body ) > 0 Then
		
		ls_Cookie = lhc_Client.Getresponseheader("Set-Cookie" )
		
		lhc_Client.SetRequestHeader ( "Cookie", ls_Cookie )
		lhc_Client.sendrequest( "POST", "https://www.appeon.com/user/center/licensemanagement", "product=pb")
		lhc_Client.GetResponsebody( ls_Body)
		tab_1.tabpage_1.mle_1.Text = ls_Body
	End If
	
Else
	MessageBox ( "Return", String ( ll_rtn ) )
End If
end event

type cb_4 from commandbutton within w_httpclient_net
boolean visible = false
integer x = 1755
integer y = 1452
integer width = 343
integer height = 100
integer taborder = 70
integer textsize = -9
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
string text = "Get Test2"
end type

event clicked;HttpClient 	lhc_Client
String 		ls_Url, ls_id, ls_Method, ls_Body
Long 			ll_rtn

lhc_Client = Create HttpClient
lhc_Client.TimeOut = 10

lhc_Client.SetRequestHeader ( "Content-Type", "application/json" )
lhc_Client.SetRequestHeader ( "Pragma", "no-cache" )
lhc_Client.SetRequestHeader ( "User-Agent", "Mozilla/5.0 (Windows NT 6.1; Trident/7.0; rv:11.0) like Gecko" )
lhc_Client.SetRequestHeader ( "Accept", "text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8" )
lhc_Client.SetRequestHeader ( "Upgrade-Insecure-Requests", "1" )
lhc_Client.SetRequestHeader ( "Accept-Encoding", "gzip, deflate" )
lhc_Client.SetRequestHeader ( "Accept-Language", "zh-CN,zh;q=0.8" )

lhc_Client.AutoReadData = True
//lhc_Client.SecureProtocol = 0
lhc_Client.Timeout = 10
ll_rtn = lhc_Client.sendrequest( "GET", "http://192.0.2.195/restful/class" )
If ll_rtn = 1 Then
	lhc_Client.GetResponsebody( ls_Body)
	If Len ( ls_body ) > 0 Then
//		mle_1.Text = ls_Body
	End If
Else
	//
End If
end event

type cb_3 from commandbutton within w_httpclient_net
boolean visible = false
integer x = 1344
integer y = 1452
integer width = 343
integer height = 100
integer taborder = 80
integer textsize = -9
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
string text = "Get Test"
end type

event clicked;HttpClient 	lhc_Client
String 		ls_Url, ls_id, ls_Method, ls_Body, ls_Respose, ls_txt
Long 			ll_rtn

lhc_Client = Create HttpClient
lhc_Client.TimeOut = 10
ls_Url = Trim ( sle_1.Text ) 
lhc_Client.SetRequestHeader ( "Content-Type", "application/json" )
lhc_Client.SetRequestHeader ( "Pragma", "no-cache" )
lhc_Client.SetRequestHeader ( "User-Agent", "Mozilla/5.0 (Windows NT 6.1; Trident/7.0; rv:11.0) like Gecko" )
//lhc_Client.SetRequestHeader("ProxyIp", "192.0.0.88:80")
//lhc_Client.AutoReadData = False
//lhc_Client.SecureProtocol = 0
//lhc_Client.Timeout = 0
ll_rtn = lhc_Client.sendrequest( "GET", ls_Url )
If ll_rtn = 1 Then
	ls_Respose = lhc_Client.Getresponseheaders( )
	ll_rtn = lhc_Client.GetResponsebody( ls_Body)
	If Len ( ls_body ) > 0 Then
		tab_1.tabpage_1.mle_1.Text = ls_Body
	End If
	ll_rtn = lhc_Client.GetResponseStatusCode()
	ls_txt = lhc_Client.GetResponseStatusText()
Else
	MessageBox ( "Return", String ( ll_rtn ) )
End If
end event

type sle_1 from singlelineedit within w_httpclient_net
boolean visible = false
integer x = 50
integer y = 1456
integer width = 1239
integer height = 84
integer taborder = 60
integer textsize = -9
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 33554432
string text = "http://www.appeon.com"
borderstyle borderstyle = stylelowered!
end type

type tab_1 from tab within w_httpclient_net
integer x = 37
integer y = 24
integer width = 3346
integer height = 1272
integer taborder = 10
integer textsize = -9
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long backcolor = 67108864
boolean raggedright = true
boolean focusonbuttondown = true
integer selectedtab = 1
tabpage_1 tabpage_1
tabpage_2 tabpage_2
tabpage_3 tabpage_3
tabpage_4 tabpage_4
tabpage_5 tabpage_5
tabpage_6 tabpage_6
tabpage_7 tabpage_7
tabpage_9 tabpage_9
end type

on tab_1.create
this.tabpage_1=create tabpage_1
this.tabpage_2=create tabpage_2
this.tabpage_3=create tabpage_3
this.tabpage_4=create tabpage_4
this.tabpage_5=create tabpage_5
this.tabpage_6=create tabpage_6
this.tabpage_7=create tabpage_7
this.tabpage_9=create tabpage_9
this.Control[]={this.tabpage_1,&
this.tabpage_2,&
this.tabpage_3,&
this.tabpage_4,&
this.tabpage_5,&
this.tabpage_6,&
this.tabpage_7,&
this.tabpage_9}
end on

on tab_1.destroy
destroy(this.tabpage_1)
destroy(this.tabpage_2)
destroy(this.tabpage_3)
destroy(this.tabpage_4)
destroy(this.tabpage_5)
destroy(this.tabpage_6)
destroy(this.tabpage_7)
destroy(this.tabpage_9)
end on

type tabpage_1 from userobject within tab_1
integer x = 18
integer y = 104
integer width = 3310
integer height = 1152
long backcolor = 67108864
string text = "GetToken"
long tabtextcolor = 33554432
long picturemaskcolor = 536870912
st_28 st_28
ddlb_1 ddlb_1
rb_2 rb_2
rb_1 rb_1
cb_1 cb_1
sle_staffid1 sle_staffid1
st_4 st_4
sle_method1 sle_method1
st_3 st_3
sle_url1 sle_url1
st_2 st_2
mle_1 mle_1
end type

on tabpage_1.create
this.st_28=create st_28
this.ddlb_1=create ddlb_1
this.rb_2=create rb_2
this.rb_1=create rb_1
this.cb_1=create cb_1
this.sle_staffid1=create sle_staffid1
this.st_4=create st_4
this.sle_method1=create sle_method1
this.st_3=create st_3
this.sle_url1=create sle_url1
this.st_2=create st_2
this.mle_1=create mle_1
this.Control[]={this.st_28,&
this.ddlb_1,&
this.rb_2,&
this.rb_1,&
this.cb_1,&
this.sle_staffid1,&
this.st_4,&
this.sle_method1,&
this.st_3,&
this.sle_url1,&
this.st_2,&
this.mle_1}
end on

on tabpage_1.destroy
destroy(this.st_28)
destroy(this.ddlb_1)
destroy(this.rb_2)
destroy(this.rb_1)
destroy(this.cb_1)
destroy(this.sle_staffid1)
destroy(this.st_4)
destroy(this.sle_method1)
destroy(this.st_3)
destroy(this.sle_url1)
destroy(this.st_2)
destroy(this.mle_1)
end on

type st_28 from statictext within tabpage_1
integer x = 2528
integer y = 116
integer width = 608
integer height = 56
integer textsize = -9
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 16711680
long backcolor = 67108864
string text = "TSL1.1和TSL1.2会失败"
boolean focusrectangle = false
end type

type ddlb_1 from dropdownlistbox within tabpage_1
integer x = 2715
integer y = 16
integer width = 411
integer height = 452
integer taborder = 60
integer textsize = -9
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 33554432
boolean enabled = false
string item[] = {"default","SSL2.0","SSL3.0","TSL1.0","TSL1.1","TSL1.2"}
borderstyle borderstyle = stylelowered!
end type

event constructor;this.selectitem( 1)

end event

type rb_2 from radiobutton within tabpage_1
integer x = 2469
integer y = 20
integer width = 247
integer height = 72
integer textsize = -9
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 33554432
long backcolor = 67108864
string text = "Https"
end type

event clicked;if rb_2.Checked Then
	rb_1.Checked = false
	sle_url1.Text = is_ip_https + "/api/Token/GetToken"
	ddlb_1.Enabled = true
End If
end event

type rb_1 from radiobutton within tabpage_1
integer x = 2226
integer y = 20
integer width = 238
integer height = 72
integer textsize = -9
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 33554432
long backcolor = 67108864
string text = "Http"
boolean checked = true
end type

event clicked;if rb_1.Checked Then
	rb_2.Checked = false
	sle_url1.Text = is_ip + "/api/Token/GetToken"
	ddlb_1.Enabled = false
End If
end event

type cb_1 from commandbutton within tabpage_1
integer x = 786
integer y = 180
integer width = 343
integer height = 100
integer taborder = 40
integer textsize = -9
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
string text = "Get Token"
end type

event clicked;HttpClient 	lhc_Client
String 		ls_Url, ls_id, ls_Method, ls_Body, ls_Respose, ls_txt, ls_Error
Long 			ll_rtn, ll_Code

lhc_Client = Create HttpClient
st_code.Text = ""
st_Text.Text = ""

lhc_Client.TimeOut = 10
If rb_2.Checked Then
	Choose Case ddlb_1.Text
		Case "default"
			lhc_Client.secureprotocol = 0
		Case 'SSL2.0'
			lhc_Client.secureprotocol = 1
		Case 'SSL3.0'
			lhc_Client.secureprotocol = 2
		Case 'TSL1.0'
			lhc_Client.secureprotocol = 3
		Case 'TSL1.1'
			lhc_Client.secureprotocol = 4
		Case 'TSL1.2'
			lhc_Client.secureprotocol = 5
		Case Else
			lhc_Client.secureprotocol = 0
	End Choose
Else
	lhc_Client.secureprotocol = 1
End If

ls_id = Trim ( sle_Staffid1.Text )
ls_Url = Trim ( sle_Url1.Text ) + "?staffId=" + ls_id
ls_Method = Trim ( sle_Method1.Text )

lhc_Client.SetRequestHeader ( "staffid", ls_id )
lhc_Client.SetRequestHeader ( "timestamp", wf_getTimeStamp() )
lhc_Client.SetRequestHeader ( "nonces", wf_getRandom() )
If Len ( is_sign ) > 0 Then
	lhc_Client.SetRequestHeader ( "signature", is_sign )
End If
lhc_Client.SetRequestHeader ( "Content-Type", "application/json" )

ll_rtn = lhc_Client.sendrequest( ls_Method, ls_Url )

If ll_rtn = 1 Then
	ls_Respose = lhc_Client.Getresponseheaders( )
	ll_rtn = lhc_Client.GetResponsebody( ls_Body)
	If Len ( ls_body ) > 0 Then
		mle_1.Text = ls_Body + "~r~n~r~n" + ls_Respose
		
		//json to string
		JsonParser lnv_JsonParser
		LongPtr ll_RootHandle, llp_Child, llp_Child2
		JsonItemType lji_1, lji_2, lji_3
		
		lnv_JsonParser = Create JsonParser
				
		ls_Error = lnv_JsonParser.loadstring(ls_Body)
		if Len(ls_Error) > 0 then
			MessageBox("Error", ls_Error)
			Return
		end if
		
		//{"Code":200,"Message":"","Data":{"StaffId":10000,"SignToken":"bb5eeee1-2959-4e80-9d7b-ec5bfd8eb4ad","ExpireTime":"2017-10-19T14:26:01.2486647+08:00"}}
		ll_RootHandle = lnv_JsonParser.GetRootItem ( ) 
		lji_1 = lnv_JsonParser.GetItemType ( ll_RootHandle )
		if lji_1 = JsonObjectItem! Then
			llp_Child = lnv_JsonParser.GetChildItem ( ll_RootHandle, 3 )
			llp_Child2 = lnv_JsonParser.GetChildItem ( llp_Child, 2 )
			is_sign = lnv_JsonParser.GetItemString ( llp_Child2 )
		End If
		
		If IsValid ( lnv_JsonParser ) Then DesTroy ( lnv_JsonParser )

	End If
	ll_Code = lhc_Client.GetResponseStatusCode()
	st_code.Text = String ( ll_Code )
	ls_txt = lhc_Client.GetResponseStatusText()
	st_Text.Text = ls_txt
Else
	mle_1.Text = "Return:" + String ( ll_rtn )
End If

If IsValid ( lhc_Client ) Then DesTroy ( lhc_Client )
end event

type sle_staffid1 from singlelineedit within tabpage_1
integer x = 265
integer y = 188
integer width = 471
integer height = 84
integer taborder = 40
integer textsize = -9
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 33554432
string text = "10000"
borderstyle borderstyle = stylelowered!
end type

type st_4 from statictext within tabpage_1
integer x = 23
integer y = 200
integer width = 187
integer height = 56
integer textsize = -9
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 33554432
long backcolor = 67108864
string text = "Staffid:"
boolean focusrectangle = false
end type

type sle_method1 from singlelineedit within tabpage_1
integer x = 265
integer y = 104
integer width = 471
integer height = 80
integer taborder = 30
integer textsize = -9
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 33554432
string text = "GET"
borderstyle borderstyle = stylelowered!
end type

type st_3 from statictext within tabpage_1
integer x = 23
integer y = 116
integer width = 219
integer height = 56
integer textsize = -9
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 33554432
long backcolor = 67108864
string text = "Method:"
boolean focusrectangle = false
end type

type sle_url1 from singlelineedit within tabpage_1
integer x = 265
integer y = 16
integer width = 1906
integer height = 84
integer taborder = 20
integer textsize = -9
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 33554432
string text = "http://192.0.3.200:9000/api/Token/GetToken"
borderstyle borderstyle = stylelowered!
end type

type st_2 from statictext within tabpage_1
integer x = 23
integer y = 28
integer width = 137
integer height = 56
integer textsize = -9
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 33554432
long backcolor = 67108864
string text = "Url:"
boolean focusrectangle = false
end type

type mle_1 from multilineedit within tabpage_1
integer x = 23
integer y = 304
integer width = 3259
integer height = 820
integer taborder = 70
integer textsize = -9
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 33554432
boolean vscrollbar = true
borderstyle borderstyle = stylelowered!
boolean hideselection = false
end type

type tabpage_2 from userobject within tab_1
event create ( )
event destroy ( )
integer x = 18
integer y = 104
integer width = 3310
integer height = 1152
long backcolor = 67108864
string text = "GetProductList"
long tabtextcolor = 33554432
long picturemaskcolor = 536870912
st_29 st_29
ddlb_2 ddlb_2
rb_4 rb_4
rb_3 rb_3
st_34 st_34
mle_2 mle_2
cb_6 cb_6
sle_staffid2 sle_staffid2
st_6 st_6
sle_method2 sle_method2
st_5 st_5
sle_url2 sle_url2
st_1 st_1
end type

on tabpage_2.create
this.st_29=create st_29
this.ddlb_2=create ddlb_2
this.rb_4=create rb_4
this.rb_3=create rb_3
this.st_34=create st_34
this.mle_2=create mle_2
this.cb_6=create cb_6
this.sle_staffid2=create sle_staffid2
this.st_6=create st_6
this.sle_method2=create sle_method2
this.st_5=create st_5
this.sle_url2=create sle_url2
this.st_1=create st_1
this.Control[]={this.st_29,&
this.ddlb_2,&
this.rb_4,&
this.rb_3,&
this.st_34,&
this.mle_2,&
this.cb_6,&
this.sle_staffid2,&
this.st_6,&
this.sle_method2,&
this.st_5,&
this.sle_url2,&
this.st_1}
end on

on tabpage_2.destroy
destroy(this.st_29)
destroy(this.ddlb_2)
destroy(this.rb_4)
destroy(this.rb_3)
destroy(this.st_34)
destroy(this.mle_2)
destroy(this.cb_6)
destroy(this.sle_staffid2)
destroy(this.st_6)
destroy(this.sle_method2)
destroy(this.st_5)
destroy(this.sle_url2)
destroy(this.st_1)
end on

type st_29 from statictext within tabpage_2
integer x = 2528
integer y = 116
integer width = 608
integer height = 56
integer textsize = -9
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 16711680
long backcolor = 67108864
string text = "TSL1.1和TSL1.2会失败"
boolean focusrectangle = false
end type

type ddlb_2 from dropdownlistbox within tabpage_2
integer x = 2715
integer y = 16
integer width = 411
integer height = 452
integer taborder = 30
integer textsize = -9
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 33554432
boolean enabled = false
string item[] = {"default","SSL2.0","SSL3.0","TSL1.0","TSL1.1","TSL1.2"}
borderstyle borderstyle = stylelowered!
end type

event constructor;this.selectitem( 1)

end event

type rb_4 from radiobutton within tabpage_2
integer x = 2469
integer y = 20
integer width = 247
integer height = 72
integer textsize = -9
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 33554432
long backcolor = 67108864
string text = "Https"
end type

event clicked;if rb_4.Checked Then
	rb_3.Checked = false
	sle_url2.Text = is_ip_https + "/api/Product/GetProductList"
	ddlb_2.Enabled = true
End If
end event

type rb_3 from radiobutton within tabpage_2
integer x = 2226
integer y = 20
integer width = 238
integer height = 72
integer textsize = -9
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 33554432
long backcolor = 67108864
string text = "Http"
boolean checked = true
end type

event clicked;if rb_3.Checked Then
	rb_4.Checked = false
	sle_url2.Text = is_ip + "/api/Product/GetProductList"
	ddlb_2.Enabled = false
End If
end event

type st_34 from statictext within tabpage_2
integer x = 1339
integer y = 200
integer width = 393
integer height = 56
integer textsize = -9
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 33554432
long backcolor = 67108864
string text = "cpu:"
boolean focusrectangle = false
end type

type mle_2 from multilineedit within tabpage_2
integer x = 23
integer y = 304
integer width = 3259
integer height = 820
integer taborder = 60
integer textsize = -9
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 33554432
boolean hscrollbar = true
boolean vscrollbar = true
borderstyle borderstyle = stylelowered!
end type

type cb_6 from commandbutton within tabpage_2
integer x = 786
integer y = 180
integer width = 453
integer height = 100
integer taborder = 50
integer textsize = -9
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
string text = "Get Product List"
end type

event clicked;HttpClient 	lhc_Client
String 		ls_Url, ls_id, ls_Method, ls_Body, ls_Respose, ls_txt, ls_Error, ls_token, ls_sign, ls_TimeStamp, ls_nonces
Long 			ll_rtn, ll_cpu, ll_Code

lhc_Client = Create HttpClient
st_code.Text = ""
st_Text.Text = ""

lhc_Client.TimeOut = 10
If rb_4.Checked Then
	Choose Case ddlb_2.Text
		Case "default"
			lhc_Client.secureprotocol = 0
		Case 'SSL2.0'
			lhc_Client.secureprotocol = 1
		Case 'SSL3.0'
			lhc_Client.secureprotocol = 2
		Case 'TSL1.0'
			lhc_Client.secureprotocol = 3
		Case 'TSL1.1'
			lhc_Client.secureprotocol = 4
		Case 'TSL1.2'
			lhc_Client.secureprotocol = 5
		Case Else
			lhc_Client.secureprotocol = 0
	End Choose
Else
	lhc_Client.secureprotocol = 0
End If
ls_id = Trim ( sle_Staffid2.Text )
ls_Url = Trim ( sle_Url2.Text ) + "?" 
ls_Method = Trim ( sle_Method2.Text )

lhc_Client.SetRequestHeader ( "staffid", ls_id )
ls_TimeStamp = wf_getTimeStamp()
lhc_Client.SetRequestHeader ( "timestamp", ls_TimeStamp)
ls_nonces = wf_getRandom()
lhc_Client.SetRequestHeader ( "nonces", ls_nonces)

lhc_Client.SetRequestHeader ( "signature", wf_getsignature(ls_TimeStamp,ls_nonces, ls_id, "" ) )
lhc_Client.SetRequestHeader ( "Content-Type", "application/json" )

ll_cpu = cpu()
ll_rtn = lhc_Client.sendrequest( ls_Method, ls_Url )

If ll_rtn = 1 Then
	ls_Respose = lhc_Client.Getresponseheaders( )
	ll_rtn = lhc_Client.GetResponsebody( ls_Body)
	If Len ( ls_body ) > 0 Then
		mle_2.Text = ls_Body	 + "~r~n~r~n" + ls_Respose
		st_34.Text =  "cpu:" + string(cpu() - ll_cpu)  +  "   Return szie:" + String ( Len (ls_body) ) 
	End If
	ll_Code = lhc_Client.GetResponseStatusCode()
	ls_txt = lhc_Client.GetResponseStatusText()
	
	st_code.Text = String ( ll_Code )
	st_Text.Text = ls_txt
	
Else
	mle_2.Text = "Return:" + String ( ll_rtn )
End If

If IsValid ( lhc_Client ) Then DesTroy ( lhc_Client )


end event

type sle_staffid2 from singlelineedit within tabpage_2
integer x = 265
integer y = 188
integer width = 471
integer height = 84
integer taborder = 50
integer textsize = -9
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 33554432
string text = "10000"
borderstyle borderstyle = stylelowered!
end type

type st_6 from statictext within tabpage_2
integer x = 23
integer y = 200
integer width = 187
integer height = 56
integer textsize = -9
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 33554432
long backcolor = 67108864
string text = "Staffid:"
boolean focusrectangle = false
end type

type sle_method2 from singlelineedit within tabpage_2
integer x = 265
integer y = 104
integer width = 471
integer height = 80
integer taborder = 40
integer textsize = -9
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 33554432
string text = "GET"
borderstyle borderstyle = stylelowered!
end type

type st_5 from statictext within tabpage_2
integer x = 23
integer y = 116
integer width = 219
integer height = 56
integer textsize = -9
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 33554432
long backcolor = 67108864
string text = "Method:"
boolean focusrectangle = false
end type

type sle_url2 from singlelineedit within tabpage_2
integer x = 265
integer y = 16
integer width = 1906
integer height = 84
integer taborder = 60
integer textsize = -9
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 33554432
string text = "http://192.0.3.200:9000/api/Product/GetProductList"
borderstyle borderstyle = stylelowered!
end type

type st_1 from statictext within tabpage_2
integer x = 23
integer y = 28
integer width = 137
integer height = 56
integer textsize = -9
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 33554432
long backcolor = 67108864
string text = "Url:"
boolean focusrectangle = false
end type

type tabpage_3 from userobject within tab_1
event create ( )
event destroy ( )
integer x = 18
integer y = 104
integer width = 3310
integer height = 1152
long backcolor = 67108864
string text = "GetProduct"
long tabtextcolor = 33554432
long picturemaskcolor = 536870912
st_35 st_35
ddlb_3 ddlb_3
rb_6 rb_6
rb_5 rb_5
st_10 st_10
sle_product3 sle_product3
st_9 st_9
st_8 st_8
st_7 st_7
sle_url3 sle_url3
sle_method3 sle_method3
sle_staffid3 sle_staffid3
mle_3 mle_3
cb_8 cb_8
end type

on tabpage_3.create
this.st_35=create st_35
this.ddlb_3=create ddlb_3
this.rb_6=create rb_6
this.rb_5=create rb_5
this.st_10=create st_10
this.sle_product3=create sle_product3
this.st_9=create st_9
this.st_8=create st_8
this.st_7=create st_7
this.sle_url3=create sle_url3
this.sle_method3=create sle_method3
this.sle_staffid3=create sle_staffid3
this.mle_3=create mle_3
this.cb_8=create cb_8
this.Control[]={this.st_35,&
this.ddlb_3,&
this.rb_6,&
this.rb_5,&
this.st_10,&
this.sle_product3,&
this.st_9,&
this.st_8,&
this.st_7,&
this.sle_url3,&
this.sle_method3,&
this.sle_staffid3,&
this.mle_3,&
this.cb_8}
end on

on tabpage_3.destroy
destroy(this.st_35)
destroy(this.ddlb_3)
destroy(this.rb_6)
destroy(this.rb_5)
destroy(this.st_10)
destroy(this.sle_product3)
destroy(this.st_9)
destroy(this.st_8)
destroy(this.st_7)
destroy(this.sle_url3)
destroy(this.sle_method3)
destroy(this.sle_staffid3)
destroy(this.mle_3)
destroy(this.cb_8)
end on

type st_35 from statictext within tabpage_3
integer x = 2528
integer y = 116
integer width = 608
integer height = 56
integer textsize = -9
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 16711680
long backcolor = 67108864
string text = "TSL1.1和TSL1.2会失败"
boolean focusrectangle = false
end type

type ddlb_3 from dropdownlistbox within tabpage_3
integer x = 2715
integer y = 16
integer width = 411
integer height = 452
integer taborder = 30
integer textsize = -9
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 33554432
boolean enabled = false
string item[] = {"default","SSL2.0","SSL3.0","TSL1.0","TSL1.1","TSL1.2"}
borderstyle borderstyle = stylelowered!
end type

event constructor;this.selectitem( 1)

end event

type rb_6 from radiobutton within tabpage_3
integer x = 2469
integer y = 20
integer width = 247
integer height = 72
integer textsize = -9
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 33554432
long backcolor = 67108864
string text = "Https"
end type

event clicked;if rb_6.Checked Then
	rb_5.Checked = false
	sle_url3.Text = is_ip_https + "/api/Product/GetProduct"
	ddlb_3.Enabled = true
End If
end event

type rb_5 from radiobutton within tabpage_3
integer x = 2226
integer y = 20
integer width = 238
integer height = 72
integer textsize = -9
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 33554432
long backcolor = 67108864
string text = "Http"
boolean checked = true
end type

event clicked;if rb_5.Checked Then
	rb_6.Checked = false
	sle_url3.Text = is_ip + "/api/Product/GetProduct"
	ddlb_3.Enabled = false
End If
end event

type st_10 from statictext within tabpage_3
integer x = 759
integer y = 200
integer width = 274
integer height = 56
integer textsize = -9
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 33554432
long backcolor = 67108864
string text = "ProductId:"
boolean focusrectangle = false
end type

type sle_product3 from singlelineedit within tabpage_3
integer x = 1047
integer y = 188
integer width = 379
integer height = 84
integer taborder = 60
integer textsize = -9
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 33554432
string text = "1"
borderstyle borderstyle = stylelowered!
end type

type st_9 from statictext within tabpage_3
integer x = 23
integer y = 200
integer width = 187
integer height = 56
integer textsize = -9
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 33554432
long backcolor = 67108864
string text = "Staffid:"
boolean focusrectangle = false
end type

type st_8 from statictext within tabpage_3
integer x = 23
integer y = 116
integer width = 219
integer height = 56
integer textsize = -9
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 33554432
long backcolor = 67108864
string text = "Method:"
boolean focusrectangle = false
end type

type st_7 from statictext within tabpage_3
integer x = 23
integer y = 28
integer width = 137
integer height = 56
integer textsize = -9
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 33554432
long backcolor = 67108864
string text = "Url:"
boolean focusrectangle = false
end type

type sle_url3 from singlelineedit within tabpage_3
integer x = 265
integer y = 16
integer width = 1906
integer height = 84
integer taborder = 10
integer textsize = -9
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 33554432
string text = "http://192.0.3.200:9000/api/Product/GetProduct"
borderstyle borderstyle = stylelowered!
end type

type sle_method3 from singlelineedit within tabpage_3
integer x = 265
integer y = 104
integer width = 471
integer height = 80
integer taborder = 50
integer textsize = -9
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 33554432
string text = "GET"
borderstyle borderstyle = stylelowered!
end type

type sle_staffid3 from singlelineedit within tabpage_3
integer x = 265
integer y = 188
integer width = 471
integer height = 84
integer taborder = 50
integer textsize = -9
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 33554432
string text = "10000"
borderstyle borderstyle = stylelowered!
end type

type mle_3 from multilineedit within tabpage_3
integer x = 23
integer y = 304
integer width = 3259
integer height = 820
integer taborder = 60
integer textsize = -9
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 33554432
boolean vscrollbar = true
borderstyle borderstyle = stylelowered!
end type

type cb_8 from commandbutton within tabpage_3
integer x = 1458
integer y = 180
integer width = 453
integer height = 100
integer taborder = 60
integer textsize = -9
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
string text = "Get Product"
end type

event clicked;HttpClient 	lhc_Client
String 		ls_Url, ls_id, ls_Method, ls_Body, ls_Respose, ls_txt, ls_Error, ls_token, ls_sign, ls_TimeStamp, ls_nonces
Long 			ll_rtn, ll_Code

lhc_Client = Create HttpClient
st_code.Text = ""
st_Text.Text = ""

lhc_Client.TimeOut = 10
If rb_6.Checked Then
	Choose Case ddlb_3.Text
		Case "default"
			lhc_Client.secureprotocol = 0
		Case 'SSL2.0'
			lhc_Client.secureprotocol = 1
		Case 'SSL3.0'
			lhc_Client.secureprotocol = 2
		Case 'TSL1.0'
			lhc_Client.secureprotocol = 3
		Case 'TSL1.1'
			lhc_Client.secureprotocol = 4
		Case 'TSL1.2'
			lhc_Client.secureprotocol = 5
		Case Else
			lhc_Client.secureprotocol = 0
	End Choose
Else
	lhc_Client.secureprotocol = 0
End If
ls_id = Trim ( sle_Staffid3.Text )
ls_Url = Trim ( sle_Url3.Text ) + "?id=" + sle_product3.Text
ls_Method = Trim ( sle_Method3.Text )

lhc_Client.SetRequestHeader ( "staffid", ls_id )
ls_TimeStamp = wf_getTimeStamp()
lhc_Client.SetRequestHeader ( "timestamp", ls_TimeStamp)
ls_nonces = wf_getRandom()
lhc_Client.SetRequestHeader ( "nonces", ls_nonces)
lhc_Client.SetRequestHeader ( "signature", wf_getsignature(ls_TimeStamp,ls_nonces, ls_id, "id" + sle_product3.Text ) )
lhc_Client.SetRequestHeader ( "Content-Type", "application/json" )

ll_rtn = lhc_Client.sendrequest( ls_Method, ls_Url )

If ll_rtn = 1 Then
	ls_Respose = lhc_Client.Getresponseheaders( )
	ll_rtn = lhc_Client.GetResponsebody( ls_Body)
	If Len ( ls_body ) > 0 Then
		mle_3.Text = ls_Body + "~r~n~r~n" + ls_Respose
	End If
	ll_Code = lhc_Client.GetResponseStatusCode()
	st_code.Text = String ( ll_Code )
	ls_txt = lhc_Client.GetResponseStatusText()
	st_Text.Text = ls_txt
Else
	mle_3.Text = "Return:" + String ( ll_rtn )
End If


If IsValid ( lhc_Client ) Then DesTroy ( lhc_Client )

end event

type tabpage_4 from userobject within tab_1
integer x = 18
integer y = 104
integer width = 3310
integer height = 1152
long backcolor = 67108864
string text = "Edit Product"
long tabtextcolor = 33554432
long picturemaskcolor = 536870912
st_36 st_36
ddlb_4 ddlb_4
rb_8 rb_8
rb_7 rb_7
mle_4 mle_4
cb_9 cb_9
sle_product4 sle_product4
st_14 st_14
sle_staffid4 sle_staffid4
st_13 st_13
sle_method4 sle_method4
st_12 st_12
st_11 st_11
sle_url4 sle_url4
end type

on tabpage_4.create
this.st_36=create st_36
this.ddlb_4=create ddlb_4
this.rb_8=create rb_8
this.rb_7=create rb_7
this.mle_4=create mle_4
this.cb_9=create cb_9
this.sle_product4=create sle_product4
this.st_14=create st_14
this.sle_staffid4=create sle_staffid4
this.st_13=create st_13
this.sle_method4=create sle_method4
this.st_12=create st_12
this.st_11=create st_11
this.sle_url4=create sle_url4
this.Control[]={this.st_36,&
this.ddlb_4,&
this.rb_8,&
this.rb_7,&
this.mle_4,&
this.cb_9,&
this.sle_product4,&
this.st_14,&
this.sle_staffid4,&
this.st_13,&
this.sle_method4,&
this.st_12,&
this.st_11,&
this.sle_url4}
end on

on tabpage_4.destroy
destroy(this.st_36)
destroy(this.ddlb_4)
destroy(this.rb_8)
destroy(this.rb_7)
destroy(this.mle_4)
destroy(this.cb_9)
destroy(this.sle_product4)
destroy(this.st_14)
destroy(this.sle_staffid4)
destroy(this.st_13)
destroy(this.sle_method4)
destroy(this.st_12)
destroy(this.st_11)
destroy(this.sle_url4)
end on

type st_36 from statictext within tabpage_4
integer x = 2528
integer y = 116
integer width = 608
integer height = 56
integer textsize = -9
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 16711680
long backcolor = 67108864
string text = "TSL1.1和TSL1.2会失败"
boolean focusrectangle = false
end type

type ddlb_4 from dropdownlistbox within tabpage_4
integer x = 2715
integer y = 16
integer width = 411
integer height = 452
integer taborder = 30
integer textsize = -9
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 33554432
boolean enabled = false
string item[] = {"default","SSL2.0","SSL3.0","TSL1.0","TSL1.1","TSL1.2"}
borderstyle borderstyle = stylelowered!
end type

event constructor;this.selectitem( 1)

end event

type rb_8 from radiobutton within tabpage_4
integer x = 2469
integer y = 20
integer width = 247
integer height = 72
integer textsize = -9
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 33554432
long backcolor = 67108864
string text = "Https"
end type

event clicked;if rb_8.Checked Then
	rb_7.Checked = false
	sle_url4.Text = is_ip_https + "/api/Product/EditProduct"
	ddlb_4.Enabled = true
End If
end event

type rb_7 from radiobutton within tabpage_4
integer x = 2226
integer y = 20
integer width = 238
integer height = 72
integer textsize = -9
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 33554432
long backcolor = 67108864
string text = "Http"
boolean checked = true
end type

event clicked;if rb_7.Checked Then
	rb_8.Checked = false
	sle_url4.Text = is_ip + "/api/Product/EditProduct"
	ddlb_4.Enabled = false
End If
end event

type mle_4 from multilineedit within tabpage_4
integer x = 23
integer y = 304
integer width = 3259
integer height = 820
integer taborder = 60
integer textsize = -9
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 33554432
boolean vscrollbar = true
borderstyle borderstyle = stylelowered!
end type

type cb_9 from commandbutton within tabpage_4
integer x = 1957
integer y = 196
integer width = 453
integer height = 100
integer taborder = 50
integer textsize = -9
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
string text = "Edit Product"
end type

event clicked;HttpClient 	lhc_Client
String 		ls_Url, ls_id, ls_Method, ls_Body, ls_Respose, ls_txt, ls_Error, ls_token, ls_sign, ls_TimeStamp, ls_nonces
String 		ls_postdata
Long 			ll_rtn, ll_Code

lhc_Client = Create HttpClient
st_code.Text = ""
st_Text.Text = ""

lhc_Client.TimeOut = 10
If rb_8.Checked Then
	Choose Case ddlb_4.Text
		Case "default"
			lhc_Client.secureprotocol = 0
		Case 'SSL2.0'
			lhc_Client.secureprotocol = 1
		Case 'SSL3.0'
			lhc_Client.secureprotocol = 2
		Case 'TSL1.0'
			lhc_Client.secureprotocol = 3
		Case 'TSL1.1'
			lhc_Client.secureprotocol = 4
		Case 'TSL1.2'
			lhc_Client.secureprotocol = 5
		Case Else
			lhc_Client.secureprotocol = 0
	End Choose
Else
	lhc_Client.secureprotocol = 0
End If
ls_id = Trim ( sle_Staffid4.Text )
ls_Url = Trim ( sle_Url4.Text ) 
ls_Method = Trim ( sle_Method4.Text )
ls_postdata = sle_product4.Text

lhc_Client.SetRequestHeader ( "staffid", ls_id )
ls_TimeStamp = wf_getTimeStamp()
lhc_Client.SetRequestHeader ( "timestamp", ls_TimeStamp)
ls_nonces = wf_getRandom()
lhc_Client.SetRequestHeader ( "nonces", ls_nonces)
lhc_Client.SetRequestHeader ( "signature", wf_getsignature(ls_TimeStamp,ls_nonces, ls_id, ls_postdata ) )
lhc_Client.SetRequestHeader ( "Content-Type", "application/json" )

ll_rtn = lhc_Client.sendrequest( ls_Method, ls_Url, ls_postdata )

If ll_rtn = 1 Then
	ls_Respose = lhc_Client.Getresponseheaders( )
	ll_rtn = lhc_Client.GetResponsebody( ls_Body)
	If Len ( ls_body ) > 0 Then
		mle_4.Text = ls_Body + "~r~n~r~n" + ls_Respose
	End If
	ll_Code = lhc_Client.GetResponseStatusCode()
	st_code.Text = String ( ll_Code )
	ls_txt = lhc_Client.GetResponseStatusText()
	st_Text.Text = ls_txt
Else
	mle_4.Text = "Return:" + String ( ll_rtn )
End If


If IsValid ( lhc_Client ) Then DesTroy ( lhc_Client )


end event

type sle_product4 from singlelineedit within tabpage_4
integer x = 1047
integer y = 104
integer width = 1362
integer height = 84
integer taborder = 50
integer textsize = -9
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 33554432
string text = "{~"Id~":1,~"Name~":~"ProductEdit~",~"Price~":8.8,~"Count~":10}"
borderstyle borderstyle = stylelowered!
end type

type st_14 from statictext within tabpage_4
integer x = 759
integer y = 116
integer width = 274
integer height = 56
integer textsize = -9
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 33554432
long backcolor = 67108864
string text = "Product:"
boolean focusrectangle = false
end type

type sle_staffid4 from singlelineedit within tabpage_4
integer x = 265
integer y = 188
integer width = 471
integer height = 84
integer taborder = 50
integer textsize = -9
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 33554432
string text = "10000"
borderstyle borderstyle = stylelowered!
end type

type st_13 from statictext within tabpage_4
integer x = 23
integer y = 200
integer width = 187
integer height = 56
integer textsize = -9
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 33554432
long backcolor = 67108864
string text = "Staffid:"
boolean focusrectangle = false
end type

type sle_method4 from singlelineedit within tabpage_4
integer x = 265
integer y = 104
integer width = 471
integer height = 80
integer taborder = 50
integer textsize = -9
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 33554432
string text = "PUT"
borderstyle borderstyle = stylelowered!
end type

type st_12 from statictext within tabpage_4
integer x = 23
integer y = 116
integer width = 219
integer height = 56
integer textsize = -9
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 33554432
long backcolor = 67108864
string text = "Method:"
boolean focusrectangle = false
end type

type st_11 from statictext within tabpage_4
integer x = 23
integer y = 28
integer width = 137
integer height = 56
integer textsize = -9
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 33554432
long backcolor = 67108864
string text = "Url:"
boolean focusrectangle = false
end type

type sle_url4 from singlelineedit within tabpage_4
integer x = 265
integer y = 16
integer width = 1906
integer height = 84
integer taborder = 10
integer textsize = -9
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 33554432
string text = "http://192.0.3.200:9000/api/Product/EditProduct"
borderstyle borderstyle = stylelowered!
end type

type tabpage_5 from userobject within tab_1
integer x = 18
integer y = 104
integer width = 3310
integer height = 1152
long backcolor = 67108864
string text = "DeleteProduct"
long tabtextcolor = 33554432
long picturemaskcolor = 536870912
st_37 st_37
ddlb_5 ddlb_5
rb_10 rb_10
rb_9 rb_9
mle_5 mle_5
cb_10 cb_10
sle_product5 sle_product5
st_18 st_18
sle_staffid5 sle_staffid5
st_17 st_17
sle_method5 sle_method5
st_16 st_16
st_15 st_15
sle_url5 sle_url5
end type

on tabpage_5.create
this.st_37=create st_37
this.ddlb_5=create ddlb_5
this.rb_10=create rb_10
this.rb_9=create rb_9
this.mle_5=create mle_5
this.cb_10=create cb_10
this.sle_product5=create sle_product5
this.st_18=create st_18
this.sle_staffid5=create sle_staffid5
this.st_17=create st_17
this.sle_method5=create sle_method5
this.st_16=create st_16
this.st_15=create st_15
this.sle_url5=create sle_url5
this.Control[]={this.st_37,&
this.ddlb_5,&
this.rb_10,&
this.rb_9,&
this.mle_5,&
this.cb_10,&
this.sle_product5,&
this.st_18,&
this.sle_staffid5,&
this.st_17,&
this.sle_method5,&
this.st_16,&
this.st_15,&
this.sle_url5}
end on

on tabpage_5.destroy
destroy(this.st_37)
destroy(this.ddlb_5)
destroy(this.rb_10)
destroy(this.rb_9)
destroy(this.mle_5)
destroy(this.cb_10)
destroy(this.sle_product5)
destroy(this.st_18)
destroy(this.sle_staffid5)
destroy(this.st_17)
destroy(this.sle_method5)
destroy(this.st_16)
destroy(this.st_15)
destroy(this.sle_url5)
end on

type st_37 from statictext within tabpage_5
integer x = 2528
integer y = 116
integer width = 608
integer height = 56
integer textsize = -9
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 16711680
long backcolor = 67108864
string text = "TSL1.1和TSL1.2会失败"
boolean focusrectangle = false
end type

type ddlb_5 from dropdownlistbox within tabpage_5
integer x = 2715
integer y = 16
integer width = 411
integer height = 452
integer taborder = 30
integer textsize = -9
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 33554432
boolean enabled = false
string item[] = {"default","SSL2.0","SSL3.0","TSL1.0","TSL1.1","TSL1.2"}
borderstyle borderstyle = stylelowered!
end type

event constructor;this.selectitem( 1)

end event

type rb_10 from radiobutton within tabpage_5
integer x = 2469
integer y = 20
integer width = 247
integer height = 72
integer textsize = -9
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 33554432
long backcolor = 67108864
string text = "Https"
end type

event clicked;if rb_10.Checked Then
	rb_9.Checked = false
	sle_url5.Text = is_ip_https + "/api/Product/DeleteProduct"
	ddlb_5.Enabled = true
End If
end event

type rb_9 from radiobutton within tabpage_5
integer x = 2226
integer y = 20
integer width = 238
integer height = 72
integer textsize = -9
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 33554432
long backcolor = 67108864
string text = "Http"
boolean checked = true
end type

event clicked;if rb_9.Checked Then
	rb_10.Checked = false
	sle_url5.Text = is_ip + "/api/Product/DeleteProduct"
	ddlb_5.Enabled = false
End If
end event

type mle_5 from multilineedit within tabpage_5
integer x = 23
integer y = 304
integer width = 3259
integer height = 820
integer taborder = 60
integer textsize = -9
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 33554432
boolean vscrollbar = true
borderstyle borderstyle = stylelowered!
end type

type cb_10 from commandbutton within tabpage_5
integer x = 1458
integer y = 180
integer width = 453
integer height = 100
integer taborder = 50
integer textsize = -9
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
string text = "Delete Product"
end type

event clicked;HttpClient 	lhc_Client
String 		ls_Url, ls_id, ls_Method, ls_Body, ls_Respose, ls_txt, ls_Error, ls_token, ls_sign, ls_TimeStamp, ls_nonces
Long 			ll_rtn, ll_Code

lhc_Client = Create HttpClient
st_code.Text = ""
st_Text.Text = ""

lhc_Client.TimeOut = 10
If rb_10.Checked Then
	Choose Case ddlb_5.Text
		Case "default"
			lhc_Client.secureprotocol = 0
		Case 'SSL2.0'
			lhc_Client.secureprotocol = 1
		Case 'SSL3.0'
			lhc_Client.secureprotocol = 2
		Case 'TSL1.0'
			lhc_Client.secureprotocol = 3
		Case 'TSL1.1'
			lhc_Client.secureprotocol = 4
		Case 'TSL1.2'
			lhc_Client.secureprotocol = 5
		Case Else
			lhc_Client.secureprotocol = 0
	End Choose
Else
	lhc_Client.secureprotocol = 0
End If
ls_id = Trim ( sle_Staffid5.Text )
ls_Url = Trim ( sle_Url5.Text ) + "?id=" + sle_product5.Text
ls_Method = Trim ( sle_Method5.Text )

lhc_Client.SetRequestHeader ( "staffid", ls_id )
ls_TimeStamp = wf_getTimeStamp()
lhc_Client.SetRequestHeader ( "timestamp", ls_TimeStamp)
ls_nonces = wf_getRandom()
lhc_Client.SetRequestHeader ( "nonces", ls_nonces)
lhc_Client.SetRequestHeader ( "signature", wf_getsignature(ls_TimeStamp,ls_nonces, ls_id, "id" + sle_product5.Text ) )
lhc_Client.SetRequestHeader ( "Content-Type", "application/json" )


ll_rtn = lhc_Client.sendrequest( ls_Method, ls_Url )

If ll_rtn = 1 Then
	ls_Respose = lhc_Client.Getresponseheaders( )
	ll_rtn = lhc_Client.GetResponsebody( ls_Body)
	If Len ( ls_body ) > 0 Then
		mle_5.Text = ls_Body + "~r~n~r~n" + ls_Respose
	End If
	ll_Code = lhc_Client.GetResponseStatusCode()
	st_code.Text = String ( ll_Code )
	ls_txt = lhc_Client.GetResponseStatusText()
	st_Text.Text = ls_txt
Else
	mle_5.Text = "Return:" + String ( ll_rtn )
End If

If IsValid ( lhc_Client ) Then DesTroy ( lhc_Client )


end event

type sle_product5 from singlelineedit within tabpage_5
integer x = 1047
integer y = 188
integer width = 379
integer height = 84
integer taborder = 50
integer textsize = -9
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 33554432
string text = "1"
borderstyle borderstyle = stylelowered!
end type

type st_18 from statictext within tabpage_5
integer x = 759
integer y = 200
integer width = 274
integer height = 56
integer textsize = -9
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 33554432
long backcolor = 67108864
string text = "ProductId:"
boolean focusrectangle = false
end type

type sle_staffid5 from singlelineedit within tabpage_5
integer x = 265
integer y = 188
integer width = 471
integer height = 84
integer taborder = 50
integer textsize = -9
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 33554432
string text = "10000"
borderstyle borderstyle = stylelowered!
end type

type st_17 from statictext within tabpage_5
integer x = 23
integer y = 200
integer width = 187
integer height = 56
integer textsize = -9
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 33554432
long backcolor = 67108864
string text = "Staffid:"
boolean focusrectangle = false
end type

type sle_method5 from singlelineedit within tabpage_5
integer x = 265
integer y = 104
integer width = 471
integer height = 80
integer taborder = 50
integer textsize = -9
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 33554432
string text = "DELETE"
borderstyle borderstyle = stylelowered!
end type

type st_16 from statictext within tabpage_5
integer x = 23
integer y = 116
integer width = 219
integer height = 56
integer textsize = -9
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 33554432
long backcolor = 67108864
string text = "Method:"
boolean focusrectangle = false
end type

type st_15 from statictext within tabpage_5
integer x = 23
integer y = 28
integer width = 137
integer height = 56
integer textsize = -9
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 33554432
long backcolor = 67108864
string text = "Url:"
boolean focusrectangle = false
end type

type sle_url5 from singlelineedit within tabpage_5
integer x = 265
integer y = 16
integer width = 1906
integer height = 84
integer taborder = 10
integer textsize = -9
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 33554432
string text = "http://192.0.3.200:9000/api/Product/DeleteProduct"
borderstyle borderstyle = stylelowered!
end type

type tabpage_6 from userobject within tab_1
integer x = 18
integer y = 104
integer width = 3310
integer height = 1152
long backcolor = 67108864
string text = "UploadFile"
long tabtextcolor = 33554432
long picturemaskcolor = 536870912
st_38 st_38
ddlb_6 ddlb_6
rb_12 rb_12
rb_11 rb_11
sle_file sle_file
cb_14 cb_14
st_30 st_30
sle_filepath sle_filepath
mle_6 mle_6
cb_11 cb_11
sle_fileid6 sle_fileid6
st_22 st_22
sle_staffid6 sle_staffid6
st_21 st_21
sle_method6 sle_method6
st_20 st_20
st_19 st_19
sle_url6 sle_url6
end type

on tabpage_6.create
this.st_38=create st_38
this.ddlb_6=create ddlb_6
this.rb_12=create rb_12
this.rb_11=create rb_11
this.sle_file=create sle_file
this.cb_14=create cb_14
this.st_30=create st_30
this.sle_filepath=create sle_filepath
this.mle_6=create mle_6
this.cb_11=create cb_11
this.sle_fileid6=create sle_fileid6
this.st_22=create st_22
this.sle_staffid6=create sle_staffid6
this.st_21=create st_21
this.sle_method6=create sle_method6
this.st_20=create st_20
this.st_19=create st_19
this.sle_url6=create sle_url6
this.Control[]={this.st_38,&
this.ddlb_6,&
this.rb_12,&
this.rb_11,&
this.sle_file,&
this.cb_14,&
this.st_30,&
this.sle_filepath,&
this.mle_6,&
this.cb_11,&
this.sle_fileid6,&
this.st_22,&
this.sle_staffid6,&
this.st_21,&
this.sle_method6,&
this.st_20,&
this.st_19,&
this.sle_url6}
end on

on tabpage_6.destroy
destroy(this.st_38)
destroy(this.ddlb_6)
destroy(this.rb_12)
destroy(this.rb_11)
destroy(this.sle_file)
destroy(this.cb_14)
destroy(this.st_30)
destroy(this.sle_filepath)
destroy(this.mle_6)
destroy(this.cb_11)
destroy(this.sle_fileid6)
destroy(this.st_22)
destroy(this.sle_staffid6)
destroy(this.st_21)
destroy(this.sle_method6)
destroy(this.st_20)
destroy(this.st_19)
destroy(this.sle_url6)
end on

type st_38 from statictext within tabpage_6
integer x = 2528
integer y = 116
integer width = 608
integer height = 56
integer textsize = -9
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 16711680
long backcolor = 67108864
string text = "TSL1.1和TSL1.2会失败"
boolean focusrectangle = false
end type

type ddlb_6 from dropdownlistbox within tabpage_6
integer x = 2715
integer y = 16
integer width = 411
integer height = 452
integer taborder = 30
integer textsize = -9
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 33554432
boolean enabled = false
string item[] = {"default","SSL2.0","SSL3.0","TSL1.0","TSL1.1","TSL1.2"}
borderstyle borderstyle = stylelowered!
end type

event constructor;this.selectitem( 1)

end event

type rb_12 from radiobutton within tabpage_6
integer x = 2469
integer y = 20
integer width = 247
integer height = 72
integer textsize = -9
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 33554432
long backcolor = 67108864
string text = "Https"
end type

event clicked;if rb_12.Checked Then
	rb_11.Checked = false
	sle_url6.Text = is_ip_https + "/api/File/UploadFile"
	ddlb_6.Enabled = true
End If
end event

type rb_11 from radiobutton within tabpage_6
integer x = 2226
integer y = 20
integer width = 238
integer height = 72
integer textsize = -9
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 33554432
long backcolor = 67108864
string text = "Http"
boolean checked = true
end type

event clicked;if rb_11.Checked Then
	rb_12.Checked = false
	sle_url6.Text = is_ip + "/api/File/UploadFile"
	ddlb_6.Enabled = false
End If
end event

type sle_file from singlelineedit within tabpage_6
integer x = 1742
integer y = 112
integer width = 366
integer height = 68
integer taborder = 50
integer textsize = -9
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 33554432
boolean enabled = false
borderstyle borderstyle = stylelowered!
end type

type cb_14 from commandbutton within tabpage_6
integer x = 2112
integer y = 96
integer width = 293
integer height = 100
integer taborder = 50
integer textsize = -9
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
string text = "Browse"
end type

event clicked;String 	ls_path, ls_file
Long 		ll_return

ll_return = getfileopenname("Select Json File",ls_path,ls_file,"*.*","All File(*.*),*.*")

If ll_Return > 0 Then
	sle_filepath.Text = ls_path
	sle_file.Text = ls_file
End IF
end event

type st_30 from statictext within tabpage_6
integer x = 759
integer y = 116
integer width = 151
integer height = 56
integer textsize = -9
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 33554432
long backcolor = 67108864
string text = "File:"
boolean focusrectangle = false
end type

type sle_filepath from singlelineedit within tabpage_6
integer x = 923
integer y = 112
integer width = 814
integer height = 68
integer taborder = 40
integer textsize = -9
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 33554432
boolean enabled = false
borderstyle borderstyle = stylelowered!
end type

type mle_6 from multilineedit within tabpage_6
integer x = 23
integer y = 304
integer width = 3259
integer height = 820
integer taborder = 60
integer textsize = -9
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 33554432
boolean hscrollbar = true
boolean vscrollbar = true
borderstyle borderstyle = stylelowered!
end type

type cb_11 from commandbutton within tabpage_6
integer x = 1344
integer y = 196
integer width = 453
integer height = 100
integer taborder = 50
integer textsize = -9
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
string text = "Upload File"
end type

event clicked;HttpClient 	lhc_Client
String 		ls_Url, ls_id, ls_Method, ls_Body, ls_Respose, ls_txt, ls_Error, ls_token, ls_sign, ls_TimeStamp, ls_nonces
String 		ls_postdata, ls_file, ls_FileID, ls_FilePath
Blob 			lb_FileData, b
Long 			ll_rtn, ll_num, flen, loops, new_pos,i, bytes_read, ll_Code


lhc_Client = Create HttpClient
st_code.Text = ""
st_Text.Text = ""

lhc_Client.TimeOut = 100
If rb_12.Checked Then
	Choose Case ddlb_6.Text
		Case "default"
			lhc_Client.secureprotocol = 0
		Case 'SSL2.0'
			lhc_Client.secureprotocol = 1
		Case 'SSL3.0'
			lhc_Client.secureprotocol = 2
		Case 'TSL1.0'
			lhc_Client.secureprotocol = 3
		Case 'TSL1.1'
			lhc_Client.secureprotocol = 4
		Case 'TSL1.2'
			lhc_Client.secureprotocol = 5
		Case Else
			lhc_Client.secureprotocol = 0
	End Choose
Else
	lhc_Client.secureprotocol = 0
End If
ls_id = Trim ( sle_Staffid6.Text )
ls_Url = Trim ( sle_Url6.Text ) 
ls_Method = Trim ( sle_Method6.Text )
ls_file = sle_file.Text
If IsNull ( ls_File ) Or Trim ( ls_File ) = "" Then
	MessageBox ( "Tip", "Not selected file!" )
	Return 
End If
ls_FileID = sle_fileid6.Text
ls_FilePath = sle_filepath.Text

If not fileexists(ls_FilePath) Then
	messagebox('提示','请选择或输入一个文件名！',StopSign!)	
	return
End If

flen = FileLength(ls_FilePath)
If flen = 0 Then
	messagebox('提示','文件长度为0！',StopSign!)	
	return
End If
ll_Num = FileOpen(ls_FilePath, &
        StreamMode!, Read!, LockRead!)
If ll_Num = -1 Then
	messagebox('提示','打开文件失败！',StopSign!)
	return
End If
//st_start.text = string(now(),'hh:mm:ss:fff')

If flen > 32765 Then
	If Mod(flen, 32765) = 0 Then
		loops = flen/32765
	ELSE
		loops = (flen/32765) + 1
	End If
ELSE
	loops = 1
End If
new_pos = 1
FOR i = 1 to loops
	bytes_read = FileRead(ll_Num, b)
	lb_FileData = lb_FileData + b
NEXT
FileClose(ll_Num)

string ls_return
nvo_base64 luo_base64
ls_return = luo_base64.base64encode(lb_FileData)


ls_postdata = '{"Id":'+ls_FileID+',"Name":"'+ls_file+'","FileData": "' + ls_return + '"}'

lhc_Client.SetRequestHeader ( "staffid", ls_id )
ls_TimeStamp = wf_getTimeStamp()
lhc_Client.SetRequestHeader ( "timestamp", ls_TimeStamp)
ls_nonces = wf_getRandom()
lhc_Client.SetRequestHeader ( "nonces", ls_nonces)
lhc_Client.SetRequestHeader ( "signature", wf_getsignature(ls_TimeStamp,ls_nonces, ls_id, ls_postdata ) )
lhc_Client.SetRequestHeader ( "Content-Type", "application/json" )

ll_rtn = lhc_Client.sEndrequest( ls_Method, ls_Url, ls_postdata )
If ll_rtn = 1 Then
	ls_Respose = lhc_Client.Getresponseheaders( )
	ll_rtn = lhc_Client.GetResponsebody( ls_Body)
	If Len ( ls_body ) > 0 Then
		mle_6.Text = ls_Body + "~r~n~r~n" + ls_Respose
	End If
	ll_Code = lhc_Client.GetResponseStatusCode()
	st_code.Text = String ( ll_Code )
	ls_txt = lhc_Client.GetResponseStatusText()
	st_Text.Text = ls_txt
Else
	mle_6.Text = "Return:" + String ( ll_rtn )
End If


If IsValid ( lhc_Client ) Then DesTroy ( lhc_Client )


end event

type sle_fileid6 from singlelineedit within tabpage_6
integer x = 923
integer y = 204
integer width = 379
integer height = 84
integer taborder = 50
integer textsize = -9
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 33554432
string text = "1"
borderstyle borderstyle = stylelowered!
end type

type st_22 from statictext within tabpage_6
integer x = 759
integer y = 216
integer width = 210
integer height = 56
integer textsize = -9
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 33554432
long backcolor = 67108864
string text = "FileId:"
boolean focusrectangle = false
end type

type sle_staffid6 from singlelineedit within tabpage_6
integer x = 265
integer y = 204
integer width = 471
integer height = 84
integer taborder = 50
integer textsize = -9
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 33554432
string text = "10000"
borderstyle borderstyle = stylelowered!
end type

type st_21 from statictext within tabpage_6
integer x = 23
integer y = 216
integer width = 187
integer height = 56
integer textsize = -9
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 33554432
long backcolor = 67108864
string text = "Staffid:"
boolean focusrectangle = false
end type

type sle_method6 from singlelineedit within tabpage_6
integer x = 265
integer y = 104
integer width = 471
integer height = 80
integer taborder = 50
integer textsize = -9
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 33554432
string text = "PUT"
borderstyle borderstyle = stylelowered!
end type

type st_20 from statictext within tabpage_6
integer x = 23
integer y = 116
integer width = 219
integer height = 56
integer textsize = -9
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 33554432
long backcolor = 67108864
string text = "Method:"
boolean focusrectangle = false
end type

type st_19 from statictext within tabpage_6
integer x = 23
integer y = 28
integer width = 137
integer height = 56
integer textsize = -9
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 33554432
long backcolor = 67108864
string text = "Url:"
boolean focusrectangle = false
end type

type sle_url6 from singlelineedit within tabpage_6
integer x = 265
integer y = 16
integer width = 1906
integer height = 84
integer taborder = 10
integer textsize = -9
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 33554432
string text = "http://192.0.3.200:9000/api/File/UploadFile"
borderstyle borderstyle = stylelowered!
end type

type tabpage_7 from userobject within tab_1
integer x = 18
integer y = 104
integer width = 3310
integer height = 1152
long backcolor = 67108864
string text = "DownloadFile"
long tabtextcolor = 33554432
long picturemaskcolor = 536870912
st_39 st_39
ddlb_7 ddlb_7
rb_14 rb_14
rb_13 rb_13
mle_7 mle_7
cb_12 cb_12
sle_filename sle_filename
st_26 st_26
sle_staffid7 sle_staffid7
st_25 st_25
sle_method7 sle_method7
st_24 st_24
st_23 st_23
sle_url7 sle_url7
end type

on tabpage_7.create
this.st_39=create st_39
this.ddlb_7=create ddlb_7
this.rb_14=create rb_14
this.rb_13=create rb_13
this.mle_7=create mle_7
this.cb_12=create cb_12
this.sle_filename=create sle_filename
this.st_26=create st_26
this.sle_staffid7=create sle_staffid7
this.st_25=create st_25
this.sle_method7=create sle_method7
this.st_24=create st_24
this.st_23=create st_23
this.sle_url7=create sle_url7
this.Control[]={this.st_39,&
this.ddlb_7,&
this.rb_14,&
this.rb_13,&
this.mle_7,&
this.cb_12,&
this.sle_filename,&
this.st_26,&
this.sle_staffid7,&
this.st_25,&
this.sle_method7,&
this.st_24,&
this.st_23,&
this.sle_url7}
end on

on tabpage_7.destroy
destroy(this.st_39)
destroy(this.ddlb_7)
destroy(this.rb_14)
destroy(this.rb_13)
destroy(this.mle_7)
destroy(this.cb_12)
destroy(this.sle_filename)
destroy(this.st_26)
destroy(this.sle_staffid7)
destroy(this.st_25)
destroy(this.sle_method7)
destroy(this.st_24)
destroy(this.st_23)
destroy(this.sle_url7)
end on

type st_39 from statictext within tabpage_7
integer x = 2528
integer y = 116
integer width = 608
integer height = 56
integer textsize = -9
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 16711680
long backcolor = 67108864
string text = "TSL1.1和TSL1.2会失败"
boolean focusrectangle = false
end type

type ddlb_7 from dropdownlistbox within tabpage_7
integer x = 2715
integer y = 16
integer width = 411
integer height = 452
integer taborder = 30
integer textsize = -9
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 33554432
boolean enabled = false
string item[] = {"default","SSL2.0","SSL3.0","TSL1.0","TSL1.1","TSL1.2"}
borderstyle borderstyle = stylelowered!
end type

event constructor;this.selectitem( 1)

end event

type rb_14 from radiobutton within tabpage_7
integer x = 2469
integer y = 20
integer width = 247
integer height = 72
integer textsize = -9
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 33554432
long backcolor = 67108864
string text = "Https"
end type

event clicked;if rb_14.Checked Then
	rb_13.Checked = false
	sle_url7.Text = is_ip_https + "/api/File/DownloadFile"
	ddlb_7.Enabled = true
End If
end event

type rb_13 from radiobutton within tabpage_7
integer x = 2226
integer y = 20
integer width = 238
integer height = 72
integer textsize = -9
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 33554432
long backcolor = 67108864
string text = "Http"
boolean checked = true
end type

event clicked;if rb_13.Checked Then
	rb_14.Checked = false
	sle_url7.Text = is_ip + "/api/File/DownloadFile"
	ddlb_7.Enabled = false
End If
end event

type mle_7 from multilineedit within tabpage_7
integer x = 23
integer y = 304
integer width = 3259
integer height = 820
integer taborder = 60
integer textsize = -9
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 33554432
boolean hscrollbar = true
boolean vscrollbar = true
borderstyle borderstyle = stylelowered!
end type

type cb_12 from commandbutton within tabpage_7
integer x = 1458
integer y = 176
integer width = 453
integer height = 100
integer taborder = 50
integer textsize = -9
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
string text = "Download File"
end type

event clicked;HttpClient 	lhc_Client
String 		ls_Url, ls_id, ls_Method, ls_Body, ls_Respose, ls_txt, ls_Error, ls_token, ls_data, ls_TimeStamp, ls_nonces
Long 			ll_rtn, ll_Code
Blob 			lb_data, b

lhc_Client = Create HttpClient
st_code.Text = ""
st_Text.Text = ""

lhc_Client.TimeOut = 20
If rb_14.Checked Then
	Choose Case ddlb_7.Text
		Case "default"
			lhc_Client.secureprotocol = 0
		Case 'SSL2.0'
			lhc_Client.secureprotocol = 1
		Case 'SSL3.0'
			lhc_Client.secureprotocol = 2
		Case 'TSL1.0'
			lhc_Client.secureprotocol = 3
		Case 'TSL1.1'
			lhc_Client.secureprotocol = 4
		Case 'TSL1.2'
			lhc_Client.secureprotocol = 5
		Case Else
			lhc_Client.secureprotocol = 0
	End Choose
Else
	lhc_Client.secureprotocol = 0
End If
ls_id = Trim ( sle_Staffid7.Text )
ls_Url = Trim ( sle_Url7.Text ) + "?fileName=" + sle_filename.Text
ls_Method = Trim ( sle_Method7.Text )

lhc_Client.SetRequestHeader ( "staffid", ls_id )
ls_TimeStamp = wf_getTimeStamp()
lhc_Client.SetRequestHeader ( "timestamp", ls_TimeStamp)
ls_nonces = wf_getRandom()
lhc_Client.SetRequestHeader ( "nonces", ls_nonces)
lhc_Client.SetRequestHeader ( "signature", wf_getsignature(ls_TimeStamp,ls_nonces, ls_id, "fileName" + sle_filename.Text  ) )
lhc_Client.SetRequestHeader ( "Content-Type", "application/json" )

ll_rtn = lhc_Client.sendrequest( ls_Method, ls_Url )

If ll_rtn = 1 Then
	ls_Respose = lhc_Client.Getresponseheaders( )
	ll_rtn = lhc_Client.GetResponsebody( ls_Body)
	If Len ( ls_body ) > 0 Then
		mle_7.Text = ls_Body + "~r~n~r~n" + ls_Respose
		//saveas file
		//json to string
		JsonParser lnv_JsonParser
		LongPtr ll_RootHandle, llp_Child, llp_Child2
		JsonItemType lji_1, lji_2
		
		lnv_JsonParser = Create JsonParser
				
		ls_Error = lnv_JsonParser.loadstring(ls_Body)
		if Len(ls_Error) > 0 then
			MessageBox("Error", ls_Error)
			Return
		end if
		
		//{"Code":200,"Message":"请求(或处理)成功","Data":{"Id":1,"Name":"md5.txt","FileData":"Ly+199P“}}
		//{"Code":200,"Message":"请求(或处理)成功","Data":null}
		ll_RootHandle = lnv_JsonParser.GetRootItem ( ) 
		lji_1 = lnv_JsonParser.GetItemType ( ll_RootHandle )
		If lji_1 = JsonObjectItem! Then
			llp_Child = lnv_JsonParser.GetChildItem ( ll_RootHandle, 3 )
			lji_2 = lnv_JsonParser.GetItemType ( llp_Child )
			If lji_2 = JsonObjectItem!Then
				llp_Child2 = lnv_JsonParser.GetChildItem ( llp_Child, 3 )
				ls_data = lnv_JsonParser.GetItemString ( llp_Child2 )
				If Len ( ls_data ) > 5 Then
					string ls_return,ls_path,ls_file
					Long 	ll_num,ll_return, flen, loops, i, bytes_read
					nvo_base64 luo_base64
					lb_data = luo_base64.base64decode( ls_data)
					
					flen = Len (lb_data)
					ll_return = GetFileSaveName("Select Json File",ls_path,ls_file,"*.*","All File(*.*),*.*")
					ll_num = FileOpen(ls_path, StreamMode!, Write!, LockWrite!, Append!)	
					If flen > 32765 Then
						
						If Mod(flen, 32765) = 0 Then
							loops = flen/32765
						ELSE
							loops = (flen/32765) + 1
						End If
					ELSE
						loops = 1
					End If
					
					FOR i = 1 to loops					
						b = BlobMid ( lb_data,32765 * ( i - 1) + 1, 32765 )
						FileWrite(ll_num, b)
					NEXT
					FileClose(ll_Num)
				End If
			Else
				MessageBox ( "Tip", "Input filename ["+ sle_filename.Text +"] not found!" )
				//mle_7.Text += "~r~n输入的文件名没有找到,请检测."
			End If
		End If
		If IsValid ( lnv_JsonParser ) Then DesTroy ( lnv_JsonParser )
	End If
	ll_Code = lhc_Client.GetResponseStatusCode()
	st_code.Text = String ( ll_Code )
	ls_txt = lhc_Client.GetResponseStatusText()
	st_Text.Text = ls_txt
Else
	mle_7.Text = "Return:" + String ( ll_rtn )
End If


If IsValid ( lhc_Client ) Then DesTroy ( lhc_Client )

end event

type sle_filename from singlelineedit within tabpage_7
integer x = 1047
integer y = 188
integer width = 379
integer height = 84
integer taborder = 50
integer textsize = -9
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 33554432
string text = "md5.txt"
borderstyle borderstyle = stylelowered!
end type

type st_26 from statictext within tabpage_7
integer x = 759
integer y = 200
integer width = 274
integer height = 56
integer textsize = -9
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 33554432
long backcolor = 67108864
string text = "fileName:"
boolean focusrectangle = false
end type

type sle_staffid7 from singlelineedit within tabpage_7
integer x = 265
integer y = 188
integer width = 471
integer height = 84
integer taborder = 50
integer textsize = -9
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 33554432
string text = "10000"
borderstyle borderstyle = stylelowered!
end type

type st_25 from statictext within tabpage_7
integer x = 23
integer y = 200
integer width = 187
integer height = 56
integer textsize = -9
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 33554432
long backcolor = 67108864
string text = "Staffid:"
boolean focusrectangle = false
end type

type sle_method7 from singlelineedit within tabpage_7
integer x = 265
integer y = 104
integer width = 471
integer height = 80
integer taborder = 50
integer textsize = -9
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 33554432
string text = "GET"
borderstyle borderstyle = stylelowered!
end type

type st_24 from statictext within tabpage_7
integer x = 23
integer y = 116
integer width = 219
integer height = 56
integer textsize = -9
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 33554432
long backcolor = 67108864
string text = "Method:"
boolean focusrectangle = false
end type

type st_23 from statictext within tabpage_7
integer x = 23
integer y = 28
integer width = 137
integer height = 56
integer textsize = -9
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 33554432
long backcolor = 67108864
string text = "Url:"
boolean focusrectangle = false
end type

type sle_url7 from singlelineedit within tabpage_7
integer x = 265
integer y = 16
integer width = 1906
integer height = 84
integer taborder = 10
integer textsize = -9
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 33554432
string text = "http://192.0.3.200:9000/api/File/DownloadFile"
borderstyle borderstyle = stylelowered!
end type

type tabpage_9 from userobject within tab_1
integer x = 18
integer y = 104
integer width = 3310
integer height = 1152
long backcolor = 67108864
string text = "GetHeaderList"
long tabtextcolor = 33554432
long picturemaskcolor = 536870912
st_40 st_40
ddlb_8 ddlb_8
rb_16 rb_16
rb_15 rb_15
mle_9 mle_9
cb_16 cb_16
sle_staffid9 sle_staffid9
st_33 st_33
sle_method9 sle_method9
st_32 st_32
sle_url9 sle_url9
st_31 st_31
end type

on tabpage_9.create
this.st_40=create st_40
this.ddlb_8=create ddlb_8
this.rb_16=create rb_16
this.rb_15=create rb_15
this.mle_9=create mle_9
this.cb_16=create cb_16
this.sle_staffid9=create sle_staffid9
this.st_33=create st_33
this.sle_method9=create sle_method9
this.st_32=create st_32
this.sle_url9=create sle_url9
this.st_31=create st_31
this.Control[]={this.st_40,&
this.ddlb_8,&
this.rb_16,&
this.rb_15,&
this.mle_9,&
this.cb_16,&
this.sle_staffid9,&
this.st_33,&
this.sle_method9,&
this.st_32,&
this.sle_url9,&
this.st_31}
end on

on tabpage_9.destroy
destroy(this.st_40)
destroy(this.ddlb_8)
destroy(this.rb_16)
destroy(this.rb_15)
destroy(this.mle_9)
destroy(this.cb_16)
destroy(this.sle_staffid9)
destroy(this.st_33)
destroy(this.sle_method9)
destroy(this.st_32)
destroy(this.sle_url9)
destroy(this.st_31)
end on

type st_40 from statictext within tabpage_9
integer x = 2528
integer y = 116
integer width = 608
integer height = 56
integer textsize = -9
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 16711680
long backcolor = 67108864
string text = "TSL1.1和TSL1.2会失败"
boolean focusrectangle = false
end type

type ddlb_8 from dropdownlistbox within tabpage_9
integer x = 2715
integer y = 16
integer width = 411
integer height = 452
integer taborder = 30
integer textsize = -9
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 33554432
boolean enabled = false
string item[] = {"default","SSL2.0","SSL3.0","TSL1.0","TSL1.1","TSL1.2"}
borderstyle borderstyle = stylelowered!
end type

event constructor;this.selectitem( 1)

end event

type rb_16 from radiobutton within tabpage_9
integer x = 2469
integer y = 20
integer width = 247
integer height = 72
integer textsize = -9
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 33554432
long backcolor = 67108864
string text = "Https"
end type

event clicked;if rb_16.Checked Then
	rb_15.Checked = false
	sle_url9.Text = is_ip_https + "/api/Header/GetHeaderList"
	ddlb_8.Enabled = true
End If
end event

type rb_15 from radiobutton within tabpage_9
integer x = 2226
integer y = 20
integer width = 238
integer height = 72
integer textsize = -9
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 33554432
long backcolor = 67108864
string text = "Http"
boolean checked = true
end type

event clicked;if rb_15.Checked Then
	rb_16.Checked = false
	sle_url9.Text = is_ip + "/api/Header/GetHeaderList"
	ddlb_8.Enabled = false
End If
end event

type mle_9 from multilineedit within tabpage_9
integer x = 23
integer y = 304
integer width = 3259
integer height = 820
integer taborder = 60
integer textsize = -9
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 33554432
boolean vscrollbar = true
borderstyle borderstyle = stylelowered!
end type

type cb_16 from commandbutton within tabpage_9
integer x = 777
integer y = 176
integer width = 453
integer height = 100
integer taborder = 60
integer textsize = -9
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
string text = "Get Header List"
end type

event clicked;HttpClient 	lhc_Client
String 		ls_Url, ls_id, ls_Method, ls_Body, ls_Respose, ls_txt, ls_Error, ls_token, ls_data, ls_TimeStamp, ls_nonces
Long 			ll_rtn, ll_code

lhc_Client = Create HttpClient
st_code.Text = ""
st_Text.Text = ""

lhc_Client.TimeOut = 10
If rb_16.Checked Then
	Choose Case ddlb_8.Text
		Case "default"
			lhc_Client.secureprotocol = 0
		Case 'SSL2.0'
			lhc_Client.secureprotocol = 1
		Case 'SSL3.0'
			lhc_Client.secureprotocol = 2
		Case 'TSL1.0'
			lhc_Client.secureprotocol = 3
		Case 'TSL1.1'
			lhc_Client.secureprotocol = 4
		Case 'TSL1.2'
			lhc_Client.secureprotocol = 5
		Case Else
			lhc_Client.secureprotocol = 0
	End Choose
Else
	lhc_Client.secureprotocol = 0
End If
ls_id = Trim ( sle_Staffid9.Text )
ls_Url = Trim ( sle_Url9.Text ) //+ "?"
ls_Method = Trim ( sle_Method9.Text )

lhc_Client.SetRequestHeader ( "staffid", ls_id )
ls_TimeStamp = wf_getTimeStamp()
lhc_Client.SetRequestHeader ( "timestamp", ls_TimeStamp)
ls_nonces = wf_getRandom()
lhc_Client.SetRequestHeader ( "nonces", ls_nonces)
lhc_Client.SetRequestHeader ( "signature", wf_getsignature(ls_TimeStamp,ls_nonces, ls_id, "") )
//lhc_Client.SetRequestHeader ( "Content-Type", "application/json" )
lhc_Client.SetRequestHeader ( "Content-Type", "application/x-www-form-urlencoded;application/json;charset=UTF-8" )
lhc_Client.SetRequestHeader ( "Pragma", "no-cache" )
lhc_Client.SetRequestHeader ( "Set-Cookie", "user=test1;" )
lhc_Client.SetRequestHeader ( "Set-Cookie", "username=test1;" )
lhc_Client.SetRequestHeader("Accept", "*/*")
lhc_Client.SetRequestHeader("Accept-Encoding", "gzip")
lhc_Client.SetRequestHeader("Accept-Language", "zh-CN,zh")
lhc_Client.SetRequestHeader("Accept-Charset", "ISO-8859-1,utf-8;q=0.7,*;q=0.7")
lhc_Client.SetRequestHeader("Allowautoredirect", "false")
lhc_Client.SetRequestHeader("Authorization", "Basic bXl1c2VyOm15cGFzcw==")
lhc_Client.SetRequestHeader("Connection", "keep-alive")
lhc_Client.SetRequestHeader("Cache-Control", "no-cache")
lhc_Client.SetRequestHeader("Cookie", "user=appeon;pwd=appeon")
lhc_Client.SetRequestHeader("ClientCertificate", "test")
//lhc_Client.SetRequestHeader("Content-Length", "4")
lhc_Client.SetRequestHeader("Date", String ( Today() ))
lhc_Client.SetRequestHeader("Expect", "100-continue")
lhc_Client.SetRequestHeader("From", "abc@appeon.com")
lhc_Client.SetRequestHeader("Host", "www.appeon.com")
lhc_Client.SetRequestHeader("If-Match", "aaaa")
lhc_Client.SetRequestHeader("If-Modified-Since", "Sat, 28 Nov 2017 06:38:19 GMT")
lhc_Client.SetRequestHeader("KeepAlive", "300")
lhc_Client.SetRequestHeader("Origin", "https://www.appeon.com")
//lhc_Client.SetRequestHeader("Postdata", "a=1&b=2")
lhc_Client.SetRequestHeader("ProtocolVersion", "1")
lhc_Client.SetRequestHeader("ProxyIp", "192.0.0.88:80")
lhc_Client.SetRequestHeader("ProxyPwd", "")
lhc_Client.SetRequestHeader("ProxyUserName", "")
lhc_Client.SetRequestHeader("ReadWriteTimeout", "5000")
lhc_Client.SetRequestHeader("Referer", "https://www.appeon.com/")
//lhc_Client.SetRequestHeader("ResultType", "Byte[2]")
//lhc_Client.SetRequestHeader("Timeout", "5000")
//lhc_Client.SetRequestHeader("URL", "https://www.appeon.com/index.php")
lhc_Client.SetRequestHeader("User-Agent", "Chrome/60.0.3112.113")
lhc_Client.SetRequestHeader("Upgrade-Insecure-Requests", "1")
lhc_Client.SetRequestHeader("X-Requested-With", "XMLHttpRequest")


ll_rtn = lhc_Client.sendrequest( ls_Method, ls_Url)

If ll_rtn = 1 Then
	ls_Respose = lhc_Client.Getresponseheaders( )
	ll_rtn = lhc_Client.GetResponsebody( ls_Body)
	If Len ( ls_body ) > 0 Then
		mle_9.Text = ls_Body + "~r~n~r~n" + ls_Respose
		//json to string
		JsonParser lnv_JsonParser
		LongPtr ll_RootHandle, llp_Child, llp_Child2
		JsonItemType lji_1, lji_2, lji_3
		
		lnv_JsonParser = Create JsonParser
				
		ls_Error = lnv_JsonParser.loadstring(ls_Body)
		if Len(ls_Error) > 0 then
			MessageBox("Error", ls_Error)
			Return
		end if
		
		ll_RootHandle = lnv_JsonParser.GetRootItem ( ) 
		lji_1 = lnv_JsonParser.GetItemType ( ll_RootHandle )
		if lji_1 = JsonObjectItem! Then
			llp_Child = lnv_JsonParser.GetChildItem ( ll_RootHandle, 3 )
			llp_Child2 = lnv_JsonParser.GetChildItem ( llp_Child, 2 )
			of_ParseJson(lnv_JsonParser, llp_Child,"")
			
			Long 	start_pos
			start_pos = Pos(is_value, "Key:")
			DO WHILE start_pos > 0		
				 is_value = Replace(is_value, start_pos, Len("Key:"), "")
				start_pos = Pos(is_value, "Key:", start_pos)						
			LOOP
			
			start_pos = Pos(is_value, "~r~n:")
			DO WHILE start_pos > 0		
				 is_value = Replace(is_value, start_pos, Len("~r~n:"), ":")
				start_pos = Pos(is_value, "~r~n:", start_pos)						
			LOOP

			mle_9.Text += "~r~n~r~n" + is_value
		End If
		
		If IsValid ( lnv_JsonParser ) Then DesTroy ( lnv_JsonParser )
		
	End If
	ll_Code = lhc_Client.GetResponseStatusCode()
	st_code.Text = String ( ll_Code )
	ls_txt = lhc_Client.GetResponseStatusText()
	st_Text.Text = ls_txt
Else
	mle_9.Text = "Return:" + String ( ll_rtn )
End If


If IsValid ( lhc_Client ) Then DesTroy ( lhc_Client )

end event

type sle_staffid9 from singlelineedit within tabpage_9
integer x = 265
integer y = 188
integer width = 471
integer height = 84
integer taborder = 50
integer textsize = -9
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 33554432
string text = "10000"
borderstyle borderstyle = stylelowered!
end type

type st_33 from statictext within tabpage_9
integer x = 23
integer y = 200
integer width = 187
integer height = 56
integer textsize = -9
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 33554432
long backcolor = 67108864
string text = "Staffid:"
boolean focusrectangle = false
end type

type sle_method9 from singlelineedit within tabpage_9
integer x = 265
integer y = 104
integer width = 471
integer height = 80
integer taborder = 50
integer textsize = -9
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 33554432
string text = "GET"
borderstyle borderstyle = stylelowered!
end type

type st_32 from statictext within tabpage_9
integer x = 23
integer y = 116
integer width = 219
integer height = 56
integer textsize = -9
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 33554432
long backcolor = 67108864
string text = "Method:"
boolean focusrectangle = false
end type

type sle_url9 from singlelineedit within tabpage_9
integer x = 265
integer y = 16
integer width = 1906
integer height = 84
integer taborder = 10
integer textsize = -9
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 33554432
string text = "http://192.0.3.200:9000/api/Header/GetHeaderList"
borderstyle borderstyle = stylelowered!
end type

type st_31 from statictext within tabpage_9
integer x = 23
integer y = 28
integer width = 137
integer height = 56
integer textsize = -9
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 33554432
long backcolor = 67108864
string text = "Url:"
boolean focusrectangle = false
end type

